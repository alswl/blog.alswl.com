<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>在 Python 中使用 epoll[译文] - Log4D</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="block-all-mixed-content">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />



<link rel="canonical" href="http://127.0.0.1:8000/2013/01/python-epoll/">

        <meta name="author" content="alswl" />
        <meta name="keywords" content="Python,译文" />
        <meta name="description" content="原文地址： http://scotdoyle.com/python-epoll-howto.html ， 我这里取精简内容翻译过来。 ============ 正文开始 ============ 介绍 Python 从 2.6 开始支持 epoll。现在我们用 Python3 来写基于这些 API 的 epoll 范例。" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css"/>
    <link href="https://cdn.staticfile.org/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://127.0.0.1:8000/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://127.0.0.1:8000/theme/css/style.css" type="text/css"/>

    <link href="http://127.0.0.1:8000/atom.xml" type="application/atom+xml" rel="alternate" title="Log4D Atom Feed" />
    <link href="http://127.0.0.1:8000/rss.xml" type="application/rss+xml" rel="alternate" title="Log4D RSS Feed" />

</head>
<body>

<div class="navbar navbar-default" role="navigation">
    <div class="container  col-lg-8 col-lg-offset-2">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://127.0.0.1:8000/" class="navbar-brand">
Log4D            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/tags/">Tags</a></li>
                    <li><a href="/links/">Links</a></li>
                    <li><a href="/about/">About</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://127.0.0.1:8000/archives/"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2">

    <section id="content">
        <article class="article-detail">
            <header class="page-header">
                <h1 class="title">
                    <a href="http://127.0.0.1:8000/2013/01/python-epoll/"
                       rel="bookmark"
                       title="Permalink to 在 Python 中使用 epoll[译文]">
                        在 Python 中使用 epoll[译文]
                    </a>
                </h1>
                <nav class="toc col-lg-2">
                  <div id="toc"><ul><li><a class="toc-href" href="#介绍" title="介绍">介绍</a></li><li><a class="toc-href" href="#阻塞的-socket-通信范例" title="阻塞的 Socket 通信范例">阻塞的 Socket 通信范例</a></li><li><a class="toc-href" href="#epoll-异步编程范例" title="epoll 异步编程范例">epoll 异步编程范例</a></li><li><a class="toc-href" href="#更多优化" title="更多优化">更多优化</a><ul><li><a class="toc-href" href="#连接等待池大小" title="连接等待池大小">连接等待池大小</a></li><li><a class="toc-href" href="#tcp-选项" title="TCP 选项">TCP 选项</a></li></ul></li></ul></div>
                </nav>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-01-12T00:01:00+08:00"> 2013-01-12</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="http://127.0.0.1:8000/tag/python/">Python</a>
        /
	<a href="http://127.0.0.1:8000/tag/yi-wen/">译文</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>原文地址： <a href="http://scotdoyle.com/python-epoll-howto.html">http://scotdoyle.com/python-epoll-howto.html</a> ， 我这里取精简内容翻译过来。</p>
<p>============ 正文开始 ============</p>
<h2 id="介绍">介绍</h2>
<p>Python 从 2.6 开始支持 <a href="http://linux.die.net/man/4/epoll">epoll</a>。现在我们用 Python3 来写基于这些 API 的 epoll 范例。</p>
<!-- more -->
<h2 id="阻塞的-socket-通信范例">阻塞的 Socket 通信范例</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="im">import</span> socket</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3">EOL1 <span class="op">=</span> b<span class="st">'</span><span class="ch">\n\n</span><span class="st">'</span></a>
<a class="sourceLine" id="cb1-4" title="4">EOL2 <span class="op">=</span> b<span class="st">'</span><span class="ch">\n\r\n</span><span class="st">'</span></a>
<a class="sourceLine" id="cb1-5" title="5">response  <span class="op">=</span> b<span class="st">'HTTP/1.0 200 OK</span><span class="ch">\r\n</span><span class="st">Date: Mon, 1 Jan 1996 01:01:01 GMT</span><span class="ch">\r\n</span><span class="st">'</span></a>
<a class="sourceLine" id="cb1-6" title="6">response <span class="op">+=</span> b<span class="st">'Content-Type: text/plain</span><span class="ch">\r\n</span><span class="st">Content-Length: 13</span><span class="ch">\r\n\r\n</span><span class="st">'</span></a>
<a class="sourceLine" id="cb1-7" title="7">response <span class="op">+=</span> b<span class="st">'Hello, world!'</span></a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9">serversocket <span class="op">=</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM)</a>
<a class="sourceLine" id="cb1-10" title="10">serversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-11" title="11">serversocket.bind((<span class="st">'0.0.0.0'</span>, <span class="dv">8080</span>))</a>
<a class="sourceLine" id="cb1-12" title="12">serversocket.listen(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="cf">try</span>:</a>
<a class="sourceLine" id="cb1-15" title="15">   <span class="cf">while</span> <span class="va">True</span>:</a>
<a class="sourceLine" id="cb1-16" title="16">      connectiontoclient, address <span class="op">=</span> serversocket.accept()</a>
<a class="sourceLine" id="cb1-17" title="17">      request <span class="op">=</span> b<span class="st">''</span></a>
<a class="sourceLine" id="cb1-18" title="18">      <span class="cf">while</span> EOL1 <span class="kw">not</span> <span class="kw">in</span> request <span class="kw">and</span> EOL2 <span class="kw">not</span> <span class="kw">in</span> request:</a>
<a class="sourceLine" id="cb1-19" title="19">          request <span class="op">+=</span> connectiontoclient.recv(<span class="dv">1024</span>)</a>
<a class="sourceLine" id="cb1-20" title="20">      <span class="bu">print</span>(<span class="st">'-'</span><span class="op">*</span><span class="dv">40</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="op">+</span> request.decode()[:<span class="op">-</span><span class="dv">2</span>])</a>
<a class="sourceLine" id="cb1-21" title="21">      connectiontoclient.send(response)</a>
<a class="sourceLine" id="cb1-22" title="22">      connectiontoclient.close()</a>
<a class="sourceLine" id="cb1-23" title="23"><span class="cf">finally</span>:</a>
<a class="sourceLine" id="cb1-24" title="24">   serversocket.close()</a></code></pre></div>
<p>这个范例中的代码在 <code>accept()</code> 、 <code>recv()</code> 和 <code>send()</code> 时候会发生阻塞， 导致其他连接无法完成。</p>
<p>通常情况下，在我们使用阻塞模型时候，会专门建立一个主线程来进行监听， 将建立成功的连接交给其他线程操作，然后继续在主线程上面监听。 这样一来，就不会受单次请求阻塞的限制。</p>
<p><a href="http://www.kegel.com/c10k.html">C10K</a> 问题描述了其他处理高并发方法，比如异步 Socket， 通过监听事件来触发预设的响应。异步 Socket 可以是单线程，也可以是多线程。</p>
<p>Python 的 API 中包含了 select / poll / epoll，具体的可用性依赖于操作系统。 他们的效率是 epoll &gt; poll &gt; select，从这个 <a href="http://lse.sourceforge.net/epoll/index.html">性能测试文章</a> 就可以看出来。</p>
<h2 id="epoll-异步编程范例">epoll 异步编程范例</h2>
<p>epoll 的流程是这样的：</p>
<ol type="1">
<li>创建 epoll 实例</li>
<li>告诉 epoll 去监听哪几种类型事件</li>
<li>向 epoll 查询最近已监听事件的变化</li>
<li>根据不同的类型做不同的处理</li>
<li>让 epoll 修改监听列表</li>
<li>重复 3-5 直到结束</li>
<li>消灭 epoll 实例</li>
</ol>
<p>范例代码：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="im">import</span> socket, select</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3">EOL1 <span class="op">=</span> b<span class="st">'</span><span class="ch">\n\n</span><span class="st">'</span></a>
<a class="sourceLine" id="cb2-4" title="4">EOL2 <span class="op">=</span> b<span class="st">'</span><span class="ch">\n\r\n</span><span class="st">'</span></a>
<a class="sourceLine" id="cb2-5" title="5">response  <span class="op">=</span> b<span class="st">'HTTP/1.0 200 OK</span><span class="ch">\r\n</span><span class="st">Date: Mon, 1 Jan 1996 01:01:01 GMT</span><span class="ch">\r\n</span><span class="st">'</span></a>
<a class="sourceLine" id="cb2-6" title="6">response <span class="op">+=</span> b<span class="st">'Content-Type: text/plain</span><span class="ch">\r\n</span><span class="st">Content-Length: 13</span><span class="ch">\r\n\r\n</span><span class="st">'</span></a>
<a class="sourceLine" id="cb2-7" title="7">response <span class="op">+=</span> b<span class="st">'Hello, world!'</span></a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9">serversocket <span class="op">=</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM)</a>
<a class="sourceLine" id="cb2-10" title="10">serversocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-11" title="11">serversocket.bind((<span class="st">'0.0.0.0'</span>, <span class="dv">8080</span>))</a>
<a class="sourceLine" id="cb2-12" title="12">serversocket.listen(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-13" title="13">serversocket.setblocking(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-14" title="14"></a>
<a class="sourceLine" id="cb2-15" title="15">epoll <span class="op">=</span> select.epoll()</a>
<a class="sourceLine" id="cb2-16" title="16">epoll.register(serversocket.fileno(), select.EPOLLIN)</a>
<a class="sourceLine" id="cb2-17" title="17"></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="cf">try</span>:</a>
<a class="sourceLine" id="cb2-19" title="19">   connections <span class="op">=</span> {}<span class="op">;</span> requests <span class="op">=</span> {}<span class="op">;</span> responses <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb2-20" title="20">   <span class="cf">while</span> <span class="va">True</span>:</a>
<a class="sourceLine" id="cb2-21" title="21">      events <span class="op">=</span> epoll.poll(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-22" title="22">      <span class="cf">for</span> fileno, event <span class="kw">in</span> events:</a>
<a class="sourceLine" id="cb2-23" title="23">         <span class="cf">if</span> fileno <span class="op">==</span> serversocket.fileno():</a>
<a class="sourceLine" id="cb2-24" title="24">            connection, address <span class="op">=</span> serversocket.accept()</a>
<a class="sourceLine" id="cb2-25" title="25">            connection.setblocking(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-26" title="26">            epoll.register(connection.fileno(), select.EPOLLIN)</a>
<a class="sourceLine" id="cb2-27" title="27">            connections[connection.fileno()] <span class="op">=</span> connection</a>
<a class="sourceLine" id="cb2-28" title="28">            requests[connection.fileno()] <span class="op">=</span> b<span class="st">''</span></a>
<a class="sourceLine" id="cb2-29" title="29">            responses[connection.fileno()] <span class="op">=</span> response</a>
<a class="sourceLine" id="cb2-30" title="30">         <span class="cf">elif</span> event <span class="op">&amp;</span> select.EPOLLIN:</a>
<a class="sourceLine" id="cb2-31" title="31">            requests[fileno] <span class="op">+=</span> connections[fileno].recv(<span class="dv">1024</span>)</a>
<a class="sourceLine" id="cb2-32" title="32">            <span class="cf">if</span> EOL1 <span class="kw">in</span> requests[fileno] <span class="kw">or</span> EOL2 <span class="kw">in</span> requests[fileno]:</a>
<a class="sourceLine" id="cb2-33" title="33">               epoll.modify(fileno, select.EPOLLOUT)</a>
<a class="sourceLine" id="cb2-34" title="34">               <span class="bu">print</span>(<span class="st">'-'</span><span class="op">*</span><span class="dv">40</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="op">+</span> requests[fileno].decode()[:<span class="op">-</span><span class="dv">2</span>])</a>
<a class="sourceLine" id="cb2-35" title="35">         <span class="cf">elif</span> event <span class="op">&amp;</span> select.EPOLLOUT:</a>
<a class="sourceLine" id="cb2-36" title="36">            byteswritten <span class="op">=</span> connections[fileno].send(responses[fileno])</a>
<a class="sourceLine" id="cb2-37" title="37">            responses[fileno] <span class="op">=</span> responses[fileno][byteswritten:]</a>
<a class="sourceLine" id="cb2-38" title="38">            <span class="cf">if</span> <span class="bu">len</span>(responses[fileno]) <span class="op">==</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb2-39" title="39">               epoll.modify(fileno, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-40" title="40">               connections[fileno].shutdown(socket.SHUT_RDWR)</a>
<a class="sourceLine" id="cb2-41" title="41">         <span class="cf">elif</span> event <span class="op">&amp;</span> select.EPOLLHUP:</a>
<a class="sourceLine" id="cb2-42" title="42">            epoll.unregister(fileno)</a>
<a class="sourceLine" id="cb2-43" title="43">            connections[fileno].close()</a>
<a class="sourceLine" id="cb2-44" title="44">            <span class="kw">del</span> connections[fileno]</a>
<a class="sourceLine" id="cb2-45" title="45"><span class="cf">finally</span>:</a>
<a class="sourceLine" id="cb2-46" title="46">   epoll.unregister(serversocket.fileno())</a>
<a class="sourceLine" id="cb2-47" title="47">   epoll.close()</a>
<a class="sourceLine" id="cb2-48" title="48">   serversocket.close()</a></code></pre></div>
<p>最关键的几行如下：</p>
<ul>
<li>16：注册感兴趣的事件</li>
<li>23：如果发现是监听 socket，则创建连接</li>
<li>30：读事件处理</li>
<li>33：读事件完成后，修改 epoll 对应的状态到写事件</li>
<li>35：写事件</li>
<li>41：释放对应的连接</li>
</ul>
<p>Epoll 分边缘触发（edge-triggered）和水平触发（level-triggered）两种， 前者只被内核触发一次通知（除非状态被改变为未就绪），后者在触发后如果不做操作， 以后仍然会收到内核的触发通知。</p>
<h2 id="更多优化">更多优化</h2>
<h3 id="连接等待池大小">连接等待池大小</h3>
<p>我们之前的代码直接使用 <code>listen()</code> 建立连接，可以通过设定一个队列大小， 在队列满了时候，就不再接受新的连接，从而保证已经接受的连接顺利完成。</p>
<h3 id="tcp-选项">TCP 选项</h3>
<p>使用 <a href="http://www.baus.net/on-tcp_cork">TCP_CORK</a> 功能，可以将小数据包封装成大包传输，提高效率。</p>
<p><a href="http://www.techrepublic.com/article/tcpip-options-for-high-performance-data-transmission/1050878">TCP_NODELAY</a> 则作用相反，将大包分成小包发送出去。比较适合实时应用比如 SSH。</p>
<p>（译者：<a href="http://www.uplook.cn/blog/8/81276/">Linux下高性能网络编程中的几个TCP/IP选项</a>介绍这几个 HTTP，写的不错。</p>
<p>范例中的源码在 <a href="http://scotdoyle.com/python-epoll-examples.tar.gz">source code</a> 下载。</p>

            </div>
            <!-- /.entry-content -->
              
<hr>
<div class="panel">
<div class="panel-body">
   <small>原文链接: <a href="https://blog.alswl.com/2013/01/python-epoll/">https://blog.alswl.com/2013/01/python-epoll/</a></small><br>
   <small>3a1ff193cee606bd1e2ea554a16353ee</small><br>
   <small>欢迎关注我的微信公众号：<a href="http://mp.weixin.qq.com/mp/getmasssendmsg?__biz=MzIyNTIwMTU3MQ==#wechat_webview_type=1&wechat_redirect">窥豹</a></small><br>
   <small><img src="https://4ocf5n.dijingchao.com/upload_dropbox/201605/qrcode_for_gh_17e2f9c2caa4_258.jpg"/></small>
   <small><img src="https://4ocf5n.dijingchao.com/upload_dropbox/meta/wechat-pay-s-crop.png"/></small>
</div>
</div>

        </article>
    </section>

        </div>
        <div class="col-lg-3 col-lg-offset-2" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="https://blog.alswl.com/atom.xml"><i class="fa fa-rss-square fa-lg"></i> RSS</a></li>
                    <li class="list-group-item"><a href="https://twitter.com/alswl"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                    <li class="list-group-item"><a href="https://github.com/alswl"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
                    <li class="list-group-item"><a href="http://weibo.com/alswlx"><i class="fa fa-weibo fa-lg"></i> Weibo</a></li>
                  </ul>
                </li>




        </ul>
    </section>

</aside>        </div>
    <div class="col-lg-3" id="sidebar">
<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><a href="http://127.0.0.1:8000/"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                    <ul class="list-group" id="categories">
                        <li class="list-group-item">
                            <a href="http://127.0.0.1:8000/category/coding/">
                                <i class="fa fa-folder-open fa-lg"></i> Coding
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://127.0.0.1:8000/category/efficiency/">
                                <i class="fa fa-folder-open fa-lg"></i> Efficiency
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://127.0.0.1:8000/category/fun/">
                                <i class="fa fa-folder-open fa-lg"></i> Fun
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://127.0.0.1:8000/category/internet/">
                                <i class="fa fa-folder-open fa-lg"></i> Internet
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://127.0.0.1:8000/category/life/">
                                <i class="fa fa-folder-open fa-lg"></i> Life
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://127.0.0.1:8000/category/managment/">
                                <i class="fa fa-folder-open fa-lg"></i> Managment
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://127.0.0.1:8000/category/thinking/">
                                <i class="fa fa-folder-open fa-lg"></i> Thinking
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://127.0.0.1:8000/category/ui/">
                                <i class="fa fa-folder-open fa-lg"></i> UI
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://127.0.0.1:8000/category/viewpoint/">
                                <i class="fa fa-folder-open fa-lg"></i> Viewpoint
                            </a>
                        </li>
                    </ul>
                </li>


        </ul>
    </section>

</aside>    </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2005-2020 alswl
            &middot; Powered by <a href="https://github.com/alswl/pelican-bootstrap3" target="_blank" style="font-weight: bold">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank" style="font-weight: bold">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank" style="font-weight: bold">Bootstrap</a>,
            <p>
              <small> <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" rel="license"><img alt="Creative Commons License" style="border-width:0" src="https://4ocf5n.dijingchao.com/upload_dropbox/meta/by-nc-nd_4-0_80x15.png"></a> Content licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" rel="license">Creative Commons Attribution 4.0 International-NonCommercial-NoDerivatives License</a>, except where indicated otherwise. </small>
            </p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->

    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-8822123-3']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
</body>
</html>