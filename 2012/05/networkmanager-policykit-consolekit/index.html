<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>关于 NetworkManager / PolicyKit / ConsoleKit 的那些屌事 | Log4D</title>
<meta name="keywords" content="linuxer, networkmanager, policykit, consolekit, gdm, gnome">
<meta name="description" content="在使用 Awesome 的过程中，我又遇到了一个老问题「NetworkManager 在非 Gnome 环境启动后，会无法 添加 / 删除 / 编辑 无线连接」。明眼人一看就知道， 这是权限的问题。 问题描述 我的环境是 ArchLinux / xmonad 0.10 / awesome v3.4.11 / GDM 3.4.1 / NetworkManager 0.9.4.0， 下面我用 awesome 做示例，其他非 Gnome WM 也应该是类似配置。 我的 WM 启动流程是： 通过 GDM 启动 xmonad / awesome，启动 xsession 是 /usr/share/xsessions/awesome.desktop， 内容如下 [Desktop Entry]">
<meta name="author" content="alswl">
<link rel="canonical" href="https://blog.alswl.com/2012/05/networkmanager-policykit-consolekit/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.1e921941d042e4ad5e05d67c1a0a128f1f4c7e7ee7732232f47971a00b164bf3.css" integrity="sha256-HpIZQdBC5K1eBdZ8GgoSjx9Mfn7ncyIy9HlxoAsWS/M=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://blog.alswl.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.alswl.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.alswl.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.alswl.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.alswl.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-8822123-3', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="关于 NetworkManager / PolicyKit / ConsoleKit 的那些屌事" />
<meta property="og:description" content="在使用 Awesome 的过程中，我又遇到了一个老问题「NetworkManager 在非 Gnome 环境启动后，会无法 添加 / 删除 / 编辑 无线连接」。明眼人一看就知道， 这是权限的问题。 问题描述 我的环境是 ArchLinux / xmonad 0.10 / awesome v3.4.11 / GDM 3.4.1 / NetworkManager 0.9.4.0， 下面我用 awesome 做示例，其他非 Gnome WM 也应该是类似配置。 我的 WM 启动流程是： 通过 GDM 启动 xmonad / awesome，启动 xsession 是 /usr/share/xsessions/awesome.desktop， 内容如下 [Desktop Entry]" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.alswl.com/2012/05/networkmanager-policykit-consolekit/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-05-17T09:07:00+08:00" />
<meta property="article:modified_time" content="2012-05-17T09:07:00+08:00" /><meta property="og:site_name" content="Log4D" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="关于 NetworkManager / PolicyKit / ConsoleKit 的那些屌事"/>
<meta name="twitter:description" content="在使用 Awesome 的过程中，我又遇到了一个老问题「NetworkManager 在非 Gnome 环境启动后，会无法 添加 / 删除 / 编辑 无线连接」。明眼人一看就知道， 这是权限的问题。 问题描述 我的环境是 ArchLinux / xmonad 0.10 / awesome v3.4.11 / GDM 3.4.1 / NetworkManager 0.9.4.0， 下面我用 awesome 做示例，其他非 Gnome WM 也应该是类似配置。 我的 WM 启动流程是： 通过 GDM 启动 xmonad / awesome，启动 xsession 是 /usr/share/xsessions/awesome.desktop， 内容如下 [Desktop Entry]"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://blog.alswl.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "关于 NetworkManager / PolicyKit / ConsoleKit 的那些屌事",
      "item": "https://blog.alswl.com/2012/05/networkmanager-policykit-consolekit/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "关于 NetworkManager / PolicyKit / ConsoleKit 的那些屌事",
  "name": "关于 NetworkManager \/ PolicyKit \/ ConsoleKit 的那些屌事",
  "description": "在使用 Awesome 的过程中，我又遇到了一个老问题「NetworkManager 在非 Gnome 环境启动后，会无法 添加 / 删除 / 编辑 无线连接」。明眼人一看就知道， 这是权限的问题。 问题描述 我的环境是 ArchLinux / xmonad 0.10 / awesome v3.4.11 / GDM 3.4.1 / NetworkManager 0.9.4.0， 下面我用 awesome 做示例，其他非 Gnome WM 也应该是类似配置。 我的 WM 启动流程是： 通过 GDM 启动 xmonad / awesome，启动 xsession 是 /usr/share/xsessions/awesome.desktop， 内容如下 [Desktop Entry]",
  "keywords": [
    "linuxer", "networkmanager", "policykit", "consolekit", "gdm", "gnome"
  ],
  "articleBody": "在使用 Awesome 的过程中，我又遇到了一个老问题「NetworkManager 在非 Gnome 环境启动后，会无法 添加 / 删除 / 编辑 无线连接」。明眼人一看就知道， 这是权限的问题。\n问题描述 我的环境是 ArchLinux / xmonad 0.10 / awesome v3.4.11 / GDM 3.4.1 / NetworkManager 0.9.4.0， 下面我用 awesome 做示例，其他非 Gnome WM 也应该是类似配置。\n我的 WM 启动流程是： 通过 GDM 启动 xmonad / awesome，启动 xsession 是 /usr/share/xsessions/awesome.desktop， 内容如下\n[Desktop Entry] Name=Awesome Comment=This session logs you into Awesome Type=Application Exec=ck-launch-session dbus-launch $HOME/.start-session.sh awesome TryExec=/usr/bin/awesome $HOME/.start-session.sh 中的作用是启动 nm-applet 和 exec awesome。\n启动之后的情况是 NetworkManager 无线 编辑/删除 按钮变灰无法点击，或者可以点击， 但是会发生 insufficient privileges 错误。\n问题原因 这个问题是由 PolicyKit 和 ConsoleKit 启动不当引起的。\nPolicyKit 是：\nPolicyKit allows fine-tuned capabilities in desktop enviroment. Traditionally only privilaged user (root) was allowed to configure network. However while in server enviroment it is reasonable assumption it would be too limiting to not allowed to connect to hotspot on laptop. Still however you may not want to give full privilages to this person (like installing programs) or you want to limit options for some people (for example on your children laptops only ’trusted’ networks with parential filters can be used). As far as I remember it works like:\nProgram send message to daemon via dbus about action Daemon uses PolicyKit libraries/configuration (in fact PolicyKit daemon) to determine if user is allowed to perform action. It may happen that the certain confition must be fullfilled (like entering password or hardware access). Deamon performs action according to it (returns auth error or perform action) ConsoleKit 是：\nIn short consolekit is service which tracks user sessions (i.e. where user is logged in). It allows switching users without logging out [many user can be logged in on the same hardware at the same time with one user active]. It is also used to check if session is “local” i.e. if user have direct access to hardware (which may be considered more secure then remote access).\n参考：What are ConsoleKit and PolicyKit? How do they work?\n所以简而言之，ConsoleKit 是用来管理用户会话的，PolicyKit 是用来处理用户申请特殊权限的， 他们两个经常工作在一起。\n有个 PolicyKit 认证 API 教程可以一看：\n使用 PolicyKit 进行身份认证（上） 使用 PolicyKit 进行身份认证（中） 使用 PolicyKit 进行身份认证（下） 我的这个问题就是由于 PolicyKit 无法正确授权引起的。\n问题解决 我开始吭次吭次的 Google，一会就找到了 Arch Wiki 中 NetworkManager 的解决办法：\nexec ck-launch-session dbus-launch wm 写的很清楚，使用 ck-launch-session 和 dbus-launch 来加载 WM。但是我已经使用 ck-launch-session 来启动 WM 了。\n随后我把怀疑的目光放到 /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 这个程序给系统提供 PolicyKit 权限认证，请求时候会让用户输入密码，如下图：\n可惜还是不行。\n我甚至还参考Using gnome keyring in xmonad 试图手工建立一个 Gnome Keyring。事实证明，Gnome Keyring 和这个问题无关。\n最后，我用 ck-list-sessions 命令查看运行的用户 Session，发现同时运行着两个， 一个处于 Active，一个不处于 Active，这下真相大白了：GDM 启动时候会自己启动 ck-launch-session，不用自己手动启动，否则会造成两个会话而无法正确授权。\nSession2: unix-user = '1000' realname = 'Jason Ti' seat = 'Seat1' session-type = '' active = TRUE x11-display = ':0' x11-display-device = '/dev/tty7' display-device = '' remote-host-name = '' is-local = TRUE on-since = '2012-05-17T00:54:31.706019Z' login-session-id = '2' Session3: unix-user = '1000' realname = 'Jason Ti' seat = 'Seat1' session-type = '' active = False x11-display = ':0' x11-display-device = '/dev/tty7' display-device = '' remote-host-name = '' is-local = TRUE on-since = '2012-05-17T00:54:33.3465302Z' login-session-id = '2' 修正 /usr/share/xsessions/awesome.desktop 如下：\n[Desktop Entry] Name=Awesome Comment=This session logs you into Awesome Type=Application Exec=$HOME/.start-session.sh awesome TryExec=/usr/bin/awesome 事实上，在启动完 GDM 还没进入 WM 之前，Ctrl+Alt+F1 切换到命令行下面，查看进程会发现\nroot 637 1 0 08:44 ? 00:00:00 /usr/lib/polkit-1/polkitd --no-debug root 1072 1 0 08:44 ? 00:00:00 /usr/sbin/console-kit-daemon --no-daemon rtkit 1260 1 0 08:45 ? 00:00:00 /usr/lib/rtkit-daemon 果不其然，PolicyKit 和 ConsoleKit 已经在运行了。\n实测 Awesome / Xmonad 已经可以正常授权 NetworkManager 来编辑无线了。\n",
  "wordCount" : "1160",
  "inLanguage": "en",
  "datePublished": "2012-05-17T09:07:00+08:00",
  "dateModified": "2012-05-17T09:07:00+08:00",
  "author":{
    "@type": "Person",
    "name": "alswl"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.alswl.com/2012/05/networkmanager-policykit-consolekit/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Log4D",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.alswl.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.alswl.com" accesskey="h" title="Log4D (Alt + H)">Log4D</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://en.blog.alswl.com/" title="English Blog">
                    <span>English Blog</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/archives/" title="存档">
                    <span>存档</span>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/about/" title="关于我">
                    <span>关于我</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.alswl.com">Home</a>&nbsp;»&nbsp;<a href="https://blog.alswl.com/posts/">Posts</a></div>
    <h1 class="post-title">
      关于 NetworkManager / PolicyKit / ConsoleKit 的那些屌事
    </h1>
    <div class="post-meta"><span title='2012-05-17 09:07:00 +0800 +0800'>2012-05-17</span>&nbsp;·&nbsp;alswl

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#问题描述">问题描述</a></li>
    <li><a href="#问题原因">问题原因</a></li>
    <li><a href="#问题解决">问题解决</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>在使用 Awesome 的过程中，我又遇到了一个老问题「NetworkManager 在非 Gnome
环境启动后，会无法 添加 / 删除 / 编辑 无线连接」。明眼人一看就知道，
这是权限的问题。</p>
<h2 id="问题描述">问题描述<a hidden class="anchor" aria-hidden="true" href="#问题描述">#</a></h2>
<p>我的环境是 <strong>ArchLinux / xmonad 0.10 / awesome v3.4.11 / GDM 3.4.1 / NetworkManager 0.9.4.0</strong>，
下面我用 awesome 做示例，其他非 Gnome WM 也应该是类似配置。</p>
<p>我的 WM 启动流程是：
通过 GDM 启动 xmonad / awesome，启动 xsession 是 <code>/usr/share/xsessions/awesome.desktop</code>，
内容如下</p>
<!-- more -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[Desktop Entry]</span>
</span></span><span class="line"><span class="cl"><span class="na">Name</span><span class="o">=</span><span class="s">Awesome</span>
</span></span><span class="line"><span class="cl"><span class="na">Comment</span><span class="o">=</span><span class="s">This session logs you into Awesome</span>
</span></span><span class="line"><span class="cl"><span class="na">Type</span><span class="o">=</span><span class="s">Application</span>
</span></span><span class="line"><span class="cl"><span class="na">Exec</span><span class="o">=</span><span class="s">ck-launch-session dbus-launch $HOME/.start-session.sh awesome</span>
</span></span><span class="line"><span class="cl"><span class="na">TryExec</span><span class="o">=</span><span class="s">/usr/bin/awesome</span>
</span></span></code></pre></div><p><code>$HOME/.start-session.sh</code> 中的作用是启动 <strong>nm-applet</strong> 和 <strong>exec awesome</strong>。</p>
<p>启动之后的情况是 NetworkManager 无线 编辑/删除 按钮变灰无法点击，或者可以点击，
但是会发生 <strong>insufficient privileges</strong> 错误。</p>
<p>




<img loading="lazy" src="https://d05fae.dijingchao.com/upload_dropbox/201205/insufficient-privileges.png" alt="insufficient privileges"  />

</p>
<h2 id="问题原因">问题原因<a hidden class="anchor" aria-hidden="true" href="#问题原因">#</a></h2>
<p>这个问题是由 PolicyKit 和 ConsoleKit 启动不当引起的。</p>
<p>PolicyKit 是：</p>
<blockquote>
<p>PolicyKit allows fine-tuned capabilities in desktop enviroment. Traditionally only privilaged user (root) was allowed to configure network. However while in server enviroment it is reasonable assumption it would be too limiting to not allowed to connect to hotspot on laptop. Still however you may not want to give full privilages to this person (like installing programs) or you want to limit options for some people (for example on your children laptops only &rsquo;trusted&rsquo; networks with parential filters can be used). As far as I remember it works like:</p>
<ul>
<li>Program send message to daemon via dbus about action</li>
<li>Daemon uses PolicyKit libraries/configuration (in fact PolicyKit daemon) to determine if user is allowed to perform action. It may happen that the certain confition must be fullfilled (like entering password or hardware access).</li>
<li>Deamon performs action according to it (returns auth error or perform action)</li>
</ul>
</blockquote>
<p>ConsoleKit 是：</p>
<blockquote>
<p>In short consolekit is service which tracks user sessions (i.e. where user is logged in). It allows switching users without logging out [many user can be logged in on the same hardware at the same time with one user active]. It is also used to check if session is &ldquo;local&rdquo; i.e. if user have direct access to hardware (which may be considered more secure then remote access).</p>
</blockquote>
<p>参考：<a href="http://unix.stackexchange.com/questions/5220/what-are-consolekit-and-policykit-how-do-they-work">What are ConsoleKit and PolicyKit? How do they work?</a></p>
<p>所以简而言之，ConsoleKit 是用来管理用户会话的，PolicyKit 是用来处理用户申请特殊权限的，
他们两个经常工作在一起。</p>
<p>有个 PolicyKit 认证 API 教程可以一看：</p>
<ul>
<li><a href="http://www.kissuki.com/blog/2009/03/10/policykit/">使用 PolicyKit 进行身份认证（上）</a></li>
<li><a href="http://www.kissuki.com/blog/2009/03/12/policykit/">使用 PolicyKit 进行身份认证（中）</a></li>
<li><a href="http://www.kissuki.com/blog/2009/03/13/policykit/">使用 PolicyKit 进行身份认证（下）</a></li>
</ul>
<p>我的这个问题就是由于 PolicyKit 无法正确授权引起的。</p>
<h2 id="问题解决">问题解决<a hidden class="anchor" aria-hidden="true" href="#问题解决">#</a></h2>
<p>我开始吭次吭次的 Google，一会就找到了 Arch Wiki 中 <a href="https://wiki.archlinux.org/index.php/NetworkManager#Set_up_PolicyKit_permissions">NetworkManager</a> 的解决办法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">exec</span> ck-launch-session dbus-launch wm
</span></span></code></pre></div><p>写的很清楚，使用 <strong>ck-launch-session</strong> 和 <strong>dbus-launch</strong> 来加载 WM。但是我已经使用
<code>ck-launch-session</code> 来启动 WM 了。</p>
<p>随后我把怀疑的目光放到 <code>/usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1</code>
这个程序给系统提供 PolicyKit 权限认证，请求时候会让用户输入密码，如下图：</p>
<p>




<img loading="lazy" src="https://d05fae.dijingchao.com/upload_dropbox/201205/policykit-agent.png" alt="PolicyKit Agent"  />

</p>
<p>可惜还是不行。</p>
<p>我甚至还参考<a href="http://blog.san-ss.com.ar/2011/03/using-gnome-keyring-in-xmonad.html">Using gnome keyring in xmonad</a>
试图手工建立一个 Gnome Keyring。事实证明，Gnome Keyring 和这个问题无关。</p>
<p>最后，我用 <code>ck-list-sessions</code> 命令查看运行的用户 Session，发现同时运行着两个，
一个处于 <code>Active</code>，一个不处于 <code>Active</code>，这下真相大白了：GDM 启动时候会自己启动
<code>ck-launch-session</code>，不用自己手动启动，否则会造成两个会话而无法正确授权。</p>
<pre tabindex="0"><code>Session2:
	unix-user = &#39;1000&#39;
	realname = &#39;Jason Ti&#39;
	seat = &#39;Seat1&#39;
	session-type = &#39;&#39;
	active = TRUE
	x11-display = &#39;:0&#39;
	x11-display-device = &#39;/dev/tty7&#39;
	display-device = &#39;&#39;
	remote-host-name = &#39;&#39;
	is-local = TRUE
	on-since = &#39;2012-05-17T00:54:31.706019Z&#39;
	login-session-id = &#39;2&#39;
Session3:
	unix-user = &#39;1000&#39;
	realname = &#39;Jason Ti&#39;
	seat = &#39;Seat1&#39;
	session-type = &#39;&#39;
	active = False
	x11-display = &#39;:0&#39;
	x11-display-device = &#39;/dev/tty7&#39;
	display-device = &#39;&#39;
	remote-host-name = &#39;&#39;
	is-local = TRUE
	on-since = &#39;2012-05-17T00:54:33.3465302Z&#39;
	login-session-id = &#39;2&#39;
</code></pre><p>修正 <code>/usr/share/xsessions/awesome.desktop</code> 如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[Desktop Entry]</span>
</span></span><span class="line"><span class="cl"><span class="na">Name</span><span class="o">=</span><span class="s">Awesome</span>
</span></span><span class="line"><span class="cl"><span class="na">Comment</span><span class="o">=</span><span class="s">This session logs you into Awesome</span>
</span></span><span class="line"><span class="cl"><span class="na">Type</span><span class="o">=</span><span class="s">Application</span>
</span></span><span class="line"><span class="cl"><span class="na">Exec</span><span class="o">=</span><span class="s">$HOME/.start-session.sh awesome</span>
</span></span><span class="line"><span class="cl"><span class="na">TryExec</span><span class="o">=</span><span class="s">/usr/bin/awesome</span>
</span></span></code></pre></div><p>事实上，在启动完 GDM 还没进入 WM 之前，<code>Ctrl+Alt+F1</code> 切换到命令行下面，查看进程会发现</p>
<pre tabindex="0"><code>root       637     1  0 08:44 ?        00:00:00 /usr/lib/polkit-1/polkitd --no-debug
root      1072     1  0 08:44 ?        00:00:00 /usr/sbin/console-kit-daemon --no-daemon
rtkit     1260     1  0 08:45 ?        00:00:00 /usr/lib/rtkit-daemon
</code></pre><p>果不其然，PolicyKit 和 ConsoleKit 已经在运行了。</p>
<p>实测 Awesome / Xmonad 已经可以正常授权 NetworkManager 来编辑无线了。</p>

<hr />
<p>原文链接: <a href="https://blog.alswl.com/2012/05/networkmanager-policykit-consolekit/">关于 NetworkManager / PolicyKit / ConsoleKit 的那些屌事 | Log4D</a></p>
<p>3a1ff193cee606bd1e2ea554a16353ee</p>
<p>欢迎关注我的微信公众号：<a
href="http://mp.weixin.qq.com/mp/getmasssendmsg?__biz=MzIyNTIwMTU3MQ==#wechat_webview_type=1&amp;wechat_redirect">窥豹</a></p>
<figure>
<img
src="https://4ocf5n.dijingchao.com/upload_dropbox/201605/qrcode_for_gh_17e2f9c2caa4_258.jpg"
alt="窥豹" />
<figcaption aria-hidden="true">窥豹</figcaption>
</figure>

    
  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.alswl.com/tags/linuxer/">linuxer</a></li>
      <li><a href="https://blog.alswl.com/tags/networkmanager/">networkmanager</a></li>
      <li><a href="https://blog.alswl.com/tags/policykit/">policykit</a></li>
      <li><a href="https://blog.alswl.com/tags/consolekit/">consolekit</a></li>
      <li><a href="https://blog.alswl.com/tags/gdm/">gdm</a></li>
      <li><a href="https://blog.alswl.com/tags/gnome/">gnome</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://blog.alswl.com/2012/05/the-non-designers-design-book/">
    <span class="title">« Prev</span>
    <br>
    <span>《写给大家看的设计书》读后感</span>
  </a>
  <a class="next" href="https://blog.alswl.com/2012/05/image-host/">
    <span class="title">Next »</span>
    <br>
    <span>使用独立图床子域名</span>
  </a>
</nav>

  </footer>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://blog.alswl.com">Log4D</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
