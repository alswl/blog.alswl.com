<!DOCTYPE html><html lang=en> <head><title>使用unison同步文件 - Log4D</title><!-- Using the latest rendering mode for IE --><meta http-equiv=X-UA-Compatible content="IE=edge"><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1.0"><meta http-equiv=Content-Security-Policy content=block-all-mixed-content><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link href=https://blog.alswl.com/2011/09/unison/ rel=canonical><meta name=author content=alswl><meta name=keywords content=Linuxer,unison><meta name=description content="1. 同步控 我是一个同步控，会妄想自己的文件遭遇不可修复性的毁灭， 因此经常丧心病狂的做备份。 比如每每备份到移动硬盘中， 比如每年一次的刻盘备份，又比如我现在要介绍的同步软件unison。 据我自己考察，这种对备份文件丢失的恐惧来自于小时候一次意外格式化F盘， 从而导致我搜集的所有《龙珠》漫画丢失而产生的。 另一个同步文件的需求来自于我的两台电脑：常驻家中的DELL 6400，是我的大房； 最近得宠的小蜜Thinkpad X201。其中6400是Win7系统， 而X200是Arch Linux主打的双系统，我希望两者的文件保持同步， 便于我两边使用时候都能检索资料。如何实现跨平台同步方案让我头疼了好久， 幸好有unison拯救了我。 2. 同步历史 很久很久以前，那时候我还喝三鹿，我开始用TotalCmd来做同步文件， 依稀记得那个功能是在 命令 里面的 比较文件夹 。 这个功能满足我当时简单粗糙的需求。只要把需要同步的文件夹分列TotalCmd两侧， 然后就可以通过命令自动查找相异的文件。 当时在我看来，尤其神奇的是文件过滤功能和按照 日期 、 文件内容 比较功能。 着实帮了我很大忙。 再过了几年，TotalCmd不能满足我了，我不想每次都选择需要同步的文件， 再用肉眼比对，同步功能也偏少。我搜寻到一款老牌的同步工具 …"><!-- Bootstrap --><link rel=stylesheet href=https://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css type=text/css><link href=https://cdn.staticfile.org/font-awesome/4.1.0/css/font-awesome.min.css rel=stylesheet><link href=https://blog.alswl.com/theme/css/pygments/native.css rel=stylesheet><link rel=stylesheet href=https://blog.alswl.com/theme/css/style.css type=text/css><link href=https://blog.alswl.com/atom.xml type=application/atom+xml rel=alternate title="Log4D Atom Feed"><link href=https://blog.alswl.com/rss.xml type=application/rss+xml rel=alternate title="Log4D RSS Feed"></head> <body> <div class="navbar navbar-default" role=navigation> <div class="container  col-lg-8 col-lg-offset-2"> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-ex1-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a href=https://blog.alswl.com/ class=navbar-brand> Log4D </a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href=/tags/ >Tags</a></li> <li><a href=/links/ >Links</a></li> <li><a href=/about/ >About</a></li> </ul> <ul class="nav navbar-nav navbar-right"> <li><a href=https://blog.alswl.com/archives/ ><i class="fa fa-th-list"></i><span class=icon-label>Archives</span></a></li> </ul> </div> <!-- /.navbar-collapse --> </div> </div> <!-- /.navbar --> <div class=container> <div class=row> <div class="col-lg-8 col-lg-offset-2"> <section id=content> <article class=article-detail> <header class=page-header> <h1 class=title> <a href=https://blog.alswl.com/2011/09/unison/ rel=bookmark title="Permalink to 使用unison同步文件"> 使用unison同步文件 </a> </h1> <nav class="toc col-lg-2"> <div id=toc><ul><li><a class=toc-href href=#同步控 title="1. 同步控">1. 同步控</a></li><li><a class=toc-href href=#同步历史 title="2. 同步历史">2. 同步历史</a></li><li><a class=toc-href href=#unison title="3. unison">3. unison</a></li><li><a class=toc-href href=#安装 title="4. 安装">4. 安装</a></li><li><a class=toc-href href=#配置 title="5. 配置">5. 配置</a></li><li><a class=toc-href href=#运行 title="6. 运行">6. 运行</a></li></ul></div> </nav> </header> <div class=entry-content> <div class=panel> <div class=panel-body> <footer class=post-info> <span class="label label-default">Date</span> <span class=published> <i class="fa fa-calendar"></i><time datetime=2011-09-27T00:00:00+08:00> 2011-09-27</time> </span> <span class="label label-default">Tags</span> <a href=https://blog.alswl.com/tag/linuxer/ >Linuxer</a> / <a href=https://blog.alswl.com/tag/unison/ >unison</a> </footer><!-- /.post-info --> </div> </div> <h2 id=同步控>1. 同步控</h2> <p>我是一个同步控，会妄想自己的文件遭遇不可修复性的毁灭， 因此经常丧心病狂的做备份。 比如每每备份到移动硬盘中， 比如每年一次的刻盘备份，又比如我现在要介绍的同步软件unison。</p> <p>据我自己考察，这种对备份文件丢失的恐惧来自于小时候一次意外格式化F盘， 从而导致我搜集的所有《龙珠》漫画丢失而产生的。</p> <p>另一个同步文件的需求来自于我的两台电脑：常驻家中的DELL 6400，是我的大房； 最近得宠的小蜜Thinkpad X201。其中6400是Win7系统， 而X200是Arch Linux主打的双系统，我希望两者的文件保持同步， 便于我两边使用时候都能检索资料。如何实现跨平台同步方案让我头疼了好久， 幸好有unison拯救了我。</p> <h2 id=同步历史>2. 同步历史</h2> <p>很久很久以前，那时候我还喝三鹿，我开始用TotalCmd来做同步文件， 依稀记得那个功能是在 <code>命令</code> 里面的 <code>比较文件夹</code> 。 这个功能满足我当时简单粗糙的需求。只要把需要同步的文件夹分列TotalCmd两侧， 然后就可以通过命令自动查找相异的文件。</p> <p>当时在我看来，尤其神奇的是文件过滤功能和按照 <code>日期</code> 、 <code>文件内容</code> 比较功能。 着实帮了我很大忙。</p> <p>再过了几年，TotalCmd不能满足我了，我不想每次都选择需要同步的文件， 再用肉眼比对，同步功能也偏少。我搜寻到一款老牌的同步工具， 叫做<a href=http://www.goodsync.com/ >GoodSync</a>，这是一款商业软件，可以试用30天， 作为专业的同步软件，这个GoodSync的确是蛮适用：支持大小写屏蔽、 文件过滤等等。</p> <p>GoodSync还可以支持网络映射硬盘，再通过Samba等协议支持，可以实现跨平台同步。 可惜GoodSync要收费，而且通过网络映射的方式也不慎完美，所以最后也弃用了。</p> <h2 id=unison>3. unison</h2> <p>终于轮到<a href=http://www.cis.upenn.edu/~bcpierce/unison/ >unison</a>闪亮登场了。 unison解决了跨平台同步，文件过滤，断点续接，大小写同步等等各种问题。</p> <p>官方介绍：</p> <blockquote> <p>Unison is a file-synchronization tool for Unix and Windows. It allows two replicas of a collection of files and directories to be stored on different hosts (or different disks on the same host), modified separately, and then brought up to date by propagating the changes in each replica to the other.</p> </blockquote> <blockquote> </blockquote> <blockquote> </blockquote> <blockquote> <p>Unison是一枚Unix和Windows通吃的文件同步工具。它允许不同电脑上（或者同一电脑上不同地方）的文件和目录之间惊心修改和同步更新。</p> </blockquote> <blockquote> </blockquote> <blockquote> </blockquote> <p>unison使用时候有服务器、客户机之分，客户机通过ssh连接到服务器端， 所以相对而言，数据通道还是安全的。</p> <h2 id=安装>4. 安装</h2> <pre><code>sudo pacman -S unison</code></pre> <p>感谢众神赐予我们各种软件包，以上是Arch Linux的安装命令。 Ubuntu之类的也差不多apt-get了。</p> <h2 id=配置>5. 配置</h2> <p>unison的传输通道用ssh，所以必须在同步的电脑上面配置好ssh， 服务端需要配置好sshd，另外最好配置好ssh公钥密钥，可以参考 <a href=http://log4d.com/2011/06/ddns-ssh>使用DDNS+SSH连通家庭/工作电脑</a>。</p> <p>unison使用 <code>~/.unison/*.prf</code> 的配置文件，默认应该会有一个 <code>default.prf</code> ， 我的 <code>default.prf</code> 配置如下。</p> <pre><code># Unison preferences file
#root = /cygdrive/f
#root = ssh://mm061.log4d.com//home/alswl</code></pre> <p>log = true</p> <p>logfile = /home/alswl/.unison/.unison.log</p> <p>#batch = true</p> <p>#auto = true</p> <p>#ignorecase = true</p> <p>ignore = Name {Thumbs.db}</p> <p>ignore = Path {music/iTunes}</p> <p>其中 <code>root</code> 表示同步的两个目录，ssh开头的服务器端路径。 <code>log</code> 设定log文件位置， <code>batch</code> 指自动同步而不经过确认， <code>auto</code> 是同步之后列出同步建议清单， 选择 <code>yes</code> or <code>no</code> 即可。 <code>ignorecase</code> 是忽略大小写，在跨平台同步时候蛮有用。 <code>ignore</code> 指忽略文件列表，分为 <code>Name</code> 和 <code>Path</code> 。</p> <p>我的default配置并不是一个可用配置，只是一个基础配置文件，用来给其他配置文件使用</p> <pre><code># Unison preferences file
include default</code></pre> <p>root = /home/alswl</p> <p>root = ssh://mm061.log4d.com//home/alswl</p> <p>path = music</p> <p>我使用 <code>include</code> 选项来加入 <code>default</code> 配置，就可以使用通用配置了。</p> <h2 id=运行>6. 运行</h2> <p>终于到了激动人心的时刻了，我们使用下面命令同步文件夹。</p> <pre><code>unison music</code></pre> <p>其中 <code>music</code> 就是之前配置好的 <code>music.prf</code> 。Papapa之后，就是各种选项了。</p> <p>unison默认情况下面会依次提醒每个差异文件的差别，可以使用键盘命令查看具体差异。 依次查看文件会很烦，所以我习惯性使用 <code>auto</code> 命令来自动合并。 <code>auto</code> 会根据文件的状态，最后更新日期来选择合适的同步操作。</p> <p>完了，没了，谢谢。</p> <p>哦，对了，当时写那篇 <a href=http://log4d.com/2011/06/ddns-ssh>使用DDNS+SSH连通家庭工作电脑</a> 大部分原因就是因为这个同步需求。而且经过我3个月来的使用，unison真是个好工具。</p> </div> <!-- /.entry-content --> <hr> <div class=panel> <div class=panel-body> <small>原文链接: <a href=https://blog.alswl.com/2011/09/unison/ >https://blog.alswl.com/2011/09/unison/</a></small><br> <small>3a1ff193cee606bd1e2ea554a16353ee</small><br> <small>欢迎关注我的微信公众号：<a href="http://mp.weixin.qq.com/mp/getmasssendmsg?__biz=MzIyNTIwMTU3MQ==#wechat_webview_type=1&wechat_redirect">窥豹</a></small><br> <small><img src=https://4ocf5n.dijingchao.com/upload_dropbox/201605/qrcode_for_gh_17e2f9c2caa4_258.jpg></small> <small><img src=https://4ocf5n.dijingchao.com/upload_dropbox/meta/wechat-pay-s-crop.png></small> </div> </div> <hr> <section class=comments id=comments> <h2>Comments</h2> <div id=disqus_thread></div> <script type=text/javascript>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'log4d'; // required: replace example with your forum shortname

                    var disqus_identifier = 'unison';
                var disqus_url = 'https://blog.alswl.com/2011/09/unison/';

            var disqus_config = function () {
                this.language = "en";
            };

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript> <a href=http://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a> </section> </article> </section> </div> <div class="col-lg-3 col-lg-offset-2" id=sidebar> <aside> <section> <ul class="list-group list-group-flush"> <li class=list-group-item><h4><i class="fa fa-home fa-lg"></i><span class=icon-label>Social</span></h4> <ul class=list-group id=social> <li class=list-group-item><a href=https://blog.alswl.com/atom.xml><i class="fa fa-rss-square fa-lg"></i> RSS</a></li> <li class=list-group-item><a href=https://twitter.com/alswl><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li> <li class=list-group-item><a href=https://github.com/alswl><i class="fa fa-github-square fa-lg"></i> Github</a></li> <li class=list-group-item><a href=http://weibo.com/alswlx><i class="fa fa-weibo fa-lg"></i> Weibo</a></li> </ul> </li> </ul> </section> </aside> </div> <div class=col-lg-3 id=sidebar> <aside> <section> <ul class="list-group list-group-flush"> <li class=list-group-item><a href=https://blog.alswl.com/ ><h4><i class="fa fa-home fa-lg"></i><span class=icon-label>Categories</span></h4></a> <ul class=list-group id=categories> <li class=list-group-item> <a href=https://blog.alswl.com/category/coding/ > <i class="fa fa-folder-open fa-lg"></i> Coding </a> </li> <li class=list-group-item> <a href=https://blog.alswl.com/category/efficiency/ > <i class="fa fa-folder-open fa-lg"></i> Efficiency </a> </li> <li class=list-group-item> <a href=https://blog.alswl.com/category/fun/ > <i class="fa fa-folder-open fa-lg"></i> Fun </a> </li> <li class=list-group-item> <a href=https://blog.alswl.com/category/internet/ > <i class="fa fa-folder-open fa-lg"></i> Internet </a> </li> <li class=list-group-item> <a href=https://blog.alswl.com/category/life/ > <i class="fa fa-folder-open fa-lg"></i> Life </a> </li> <li class=list-group-item> <a href=https://blog.alswl.com/category/managment/ > <i class="fa fa-folder-open fa-lg"></i> Managment </a> </li> <li class=list-group-item> <a href=https://blog.alswl.com/category/sre/ > <i class="fa fa-folder-open fa-lg"></i> SRE </a> </li> <li class=list-group-item> <a href=https://blog.alswl.com/category/thinking/ > <i class="fa fa-folder-open fa-lg"></i> Thinking </a> </li> <li class=list-group-item> <a href=https://blog.alswl.com/category/ui/ > <i class="fa fa-folder-open fa-lg"></i> UI </a> </li> <li class=list-group-item> <a href=https://blog.alswl.com/category/viewpoint/ > <i class="fa fa-folder-open fa-lg"></i> Viewpoint </a> </li> </ul> </li> </ul> </section> </aside> </div> </div> </div> <footer> <div class=container> <hr> <div class=row> <div class=col-xs-10>&copy; 2005-2021 alswl &middot; Powered by <a href=https://github.com/alswl/pelican-bootstrap3 target=_blank style="font-weight: bold">pelican-bootstrap3</a>, <a href=http://docs.getpelican.com/ target=_blank style="font-weight: bold">Pelican</a>, <a href=http://getbootstrap.com target=_blank style="font-weight: bold">Bootstrap</a>, <p> <small> <a href=http://creativecommons.org/licenses/by-nc-nd/4.0/ rel=license><img alt="Creative Commons License" style=border-width:0 src=https://4ocf5n.dijingchao.com/upload_dropbox/meta/by-nc-nd_4-0_80x15.png></a> Content licensed under a <a href=http://creativecommons.org/licenses/by-nc-nd/4.0/ rel=license>Creative Commons Attribution 4.0 International-NonCommercial-NoDerivatives License</a>, except where indicated otherwise. </small> </p> </div> <div class=col-xs-2><p class=pull-right><i class="fa fa-arrow-up"></i> <a href=#>Back to top</a></p></div> </div> </div> </footer> <script src=https://cdn.staticfile.org/jquery/1.11.0/jquery.min.js></script> <!-- Include all compiled plugins (below), or include individual files as needed --> <script src=https://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js></script> <!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) --> <!-- Disqus --> <script type=text/javascript>
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'log4d'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script> <!-- End Disqus Code --> <!-- Google Analytics --> <script type=text/javascript>

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-8822123-3']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script> <!-- End Google Analytics Code --> </body> </html>