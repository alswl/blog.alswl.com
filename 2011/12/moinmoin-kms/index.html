<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>使用MoinMoin作为个人KMS | Log4D</title>
<meta name="keywords" content="工欲善其事必先利其器, image2attach, kms, moinmoin, nginx, uwsgi, wiz">
<meta name="description" content="去年9月份时候，我写过一篇《我所使用的知识管理系统》 来介绍我使用的KMS系统。当时经过我层层筛选之后，我选用了Wiz作为我的KMS。 一年多过去了，Wiz在Windows下面工作的非常不错，Wiz团队里陆续推出了iOS / Android / Web版本。我的Wiz收藏的内容也增加到近1000篇。 此时我遇到了KMS再选型的问题，原因很简单：我全线转换到Linux平台， Wiz不符合我的要求了。 我重新整理一下我要求KMS的">
<meta name="author" content="alswl">
<link rel="canonical" href="https://blog.alswl.com/2011/12/moinmoin-kms/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a3c38bde43550bf3cac1612e16d00b32f53b6d9c71f76ca29687db5d86bca0ea.css" integrity="sha256-o8OL3kNVC/PKwWEuFtALMvU7bZxx92yilofbXYa8oOo=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://blog.alswl.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.alswl.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.alswl.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.alswl.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.alswl.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-8822123-3', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="使用MoinMoin作为个人KMS" />
<meta property="og:description" content="去年9月份时候，我写过一篇《我所使用的知识管理系统》 来介绍我使用的KMS系统。当时经过我层层筛选之后，我选用了Wiz作为我的KMS。 一年多过去了，Wiz在Windows下面工作的非常不错，Wiz团队里陆续推出了iOS / Android / Web版本。我的Wiz收藏的内容也增加到近1000篇。 此时我遇到了KMS再选型的问题，原因很简单：我全线转换到Linux平台， Wiz不符合我的要求了。 我重新整理一下我要求KMS的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.alswl.com/2011/12/moinmoin-kms/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-12-26T00:00:00+08:00" />
<meta property="article:modified_time" content="2011-12-26T00:00:00+08:00" /><meta property="og:site_name" content="Log4D" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用MoinMoin作为个人KMS"/>
<meta name="twitter:description" content="去年9月份时候，我写过一篇《我所使用的知识管理系统》 来介绍我使用的KMS系统。当时经过我层层筛选之后，我选用了Wiz作为我的KMS。 一年多过去了，Wiz在Windows下面工作的非常不错，Wiz团队里陆续推出了iOS / Android / Web版本。我的Wiz收藏的内容也增加到近1000篇。 此时我遇到了KMS再选型的问题，原因很简单：我全线转换到Linux平台， Wiz不符合我的要求了。 我重新整理一下我要求KMS的"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://blog.alswl.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "使用MoinMoin作为个人KMS",
      "item": "https://blog.alswl.com/2011/12/moinmoin-kms/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "使用MoinMoin作为个人KMS",
  "name": "使用MoinMoin作为个人KMS",
  "description": "去年9月份时候，我写过一篇《我所使用的知识管理系统》 来介绍我使用的KMS系统。当时经过我层层筛选之后，我选用了Wiz作为我的KMS。 一年多过去了，Wiz在Windows下面工作的非常不错，Wiz团队里陆续推出了iOS / Android / Web版本。我的Wiz收藏的内容也增加到近1000篇。 此时我遇到了KMS再选型的问题，原因很简单：我全线转换到Linux平台， Wiz不符合我的要求了。 我重新整理一下我要求KMS的",
  "keywords": [
    "工欲善其事必先利其器", "image2attach", "kms", "moinmoin", "nginx", "uwsgi", "wiz"
  ],
  "articleBody": "去年9月份时候，我写过一篇《我所使用的知识管理系统》 来介绍我使用的KMS系统。当时经过我层层筛选之后，我选用了Wiz作为我的KMS。\n一年多过去了，Wiz在Windows下面工作的非常不错，Wiz团队里陆续推出了iOS / Android / Web版本。我的Wiz收藏的内容也增加到近1000篇。\n此时我遇到了KMS再选型的问题，原因很简单：我全线转换到Linux平台， Wiz不符合我的要求了。\n我重新整理一下我要求KMS的特性：\n跨平台：Linux / Web / iOS / Android / Windows 数据保存格式：移植方便，将图片保存到本地 数据采集方式：支持网络直接拷贝复制 数据索引：支持分类 + tag 协同工作：方便的分享机制 免费 经过我历时N月的搜寻筛选，MoinMoin Wiki中标了！\n1. 关于MoinMoin MoinMoin是使用Python编写的Wiki实现，MoinMoin当前版本1.9。\nMoinMoin的优点是：\n安装简单; 支持中文全文检索； 汉化较好； 不依赖外界的数据库, 使用纯文本保存, 备份非常容易, 直接复制即可。 支持从html转换到MoinMoin Wiki格式，纯文本的wiki格式比html来的更纯粹，只保存需要的数据，而不保存冗余的样式，MoinMoin这点做的非常好，支持几乎全部html标记的转换。 2. 安装MoinMoin MoinMoin基于Python，因此安装比基于php的MediaWiki麻烦一点。\n你也可以参考官方安装指导（英文），里面有 Ubuntu / CentOS / SuSE 等系统的安装方法。\n2.1. 使用MoinMoin桌面版（最简单） 好在有MoinMoin下载包里面包含了简单的可执行版本，只需3个步骤就可以运行了。\n下载 MoinMoin MoinMoinDownload - MoinMoin 解压缩到合适的目录（安装目录） 运行目录下面的 wikiserver.py Linux/Unix：在命令行里面运行 wikiserver.py Mac：在 wikiserver.py 上面点击右键，选择 open with... - All Applications - Always Open With - Terminal.app Windows：下载 Python （2.5-2.6）， 安装之后双击 wikiserver.py 运行。 安装好之后，打开浏览器，在地址栏输入 http://localhost:8080/ 即可访问。\nPS：如果你将MoinMoin安装的优盘，甚至可以做成移动知识库哦~\n更多可以参考 官方DesktopEdition帮助文档（英文）\n2.2. nginx+uWsgi方式（程序员适用） wikiserver.py 虽然可以运行，但是作为开发者，我当然要使用效率更高的方式。 运行Python Web应用需要 Appach / ngnix + CGI / FastCGI / uWSGI 环境。 我这里使用nginx + uWSGI进行环境配置。\nGoogle了N多资料之后，这篇 ArchLinux 下使用 Nginx + uWSGI 部署 MoinMoin 最是详细，另外还可以参考 运行在 nginx 与 uwsgi 之上的 moinmoin。\n我将主要步骤和我的一些修改列出来。\n2.2.1. 安装需要软件 我当前系统是Arch，运行一下命令安装，其他系统也类似\npacman -S nginx moinmoin yaourt uwsgi 2.2.2. 配置MoinMoin 默认情况下，moinmoin 被安装在了 /usr/lib/python2.7/site-packages/MoinMoin 和 /usr/moin/share 这两个目录下。\ncd /usr/share/moin/ ln -s /usr/share/moin/server/moin.wsgi . ln -s /usr/share/moin/config/wikiconfig.py . 2.2.3. 配置nginx 在上文的基础上，我做了一些小修改，我的nginx站点配置如下，我没有使用端口9090 作为uwsgi的监听端口，而是使用了UNIX Sock，这样相对安全一些。\nps：貌似这个版本的uwsgi 0.9.9.2有点小问题，无法在 /var/run 里面创建sock， 我只能将 uwsgi.sock 放在 /tmp 里面\nserver { listen 80; server_name wiki.localhost; location /{ include uwsgi_params; #uwsgi_pass 127.0.0.1:9090; uwsgi_pass unix:/tmp/uwsgi.sock; uwsgi_param UWSGI_PYHOME /usr/lib/python2.7/site-packages/MoinMoin; uwsgi_param UWSGI_CHDIR /usr/share/moin; uwsgi_param UWSGI_SCRIPT moin_wsgi; } } # vim: set ft=conf: 2.2.4. 配置启动文件 因为使用 UNIX Sock 连接，所以 /etc/rc.d/uwsgi 启动文件也略做修改（ Ubunt 的启动配置文件在 /etc/init.d/ 下面）， 加入了 SOCK ，同时我为 uwsgi 指定运行用户 http ，避免root启动带来的安全隐患。\n#!/bin/bash #PORT=9090 SOCK=/tmp/uwsgi.sock PROCESSES=4 USER=httpLOG=/var/log/uwsgi.log PID=`pidof -o %PPID /usr/bin/uwsgi` . /etc/rc.conf . /etc/rc.d/functions case \"$1\" in start) stat_busy \"Starting uwsgi\" if [ -n \"$PID\" ]; then stat_busy \"uwsgi is already running\" stat_die else #uwsgi --uid $USER -s \":$PORT\" -M -p $PROCESSES -d $LOG \u0026\u003e /dev/null # use socket port uwsgi --uid $USER --socket $SOCK -M -p $PROCESSES -d $LOG \u0026\u003e /dev/null # use unix sock add_daemon uwsgi stat_done fi ;; stop) stat_busy \"Stopping uwsgi\" killall -QUIT uwsgi \u0026\u003e /dev/null rm_daemon uwsgi stat_done ;; restart) $0 stop sleep 1 $0 start ;; *) echo \"usage: $0 {start|stop|restart}\" esac exit 0 3. Image2Attach 去年我选择Wiz而不选择Wiki类产品时候，是考虑到一个图片保存本地化的问题。 即保存一篇网页时候，要将里面的图片保存到本地，而不是使用链接方式保存， 因为由于各种不可预测的原因，原始图片数据很有可能丢失或者无法连接。\nWiz使用的方案是使用mht格式将图片保存在问题，而大部分 Wiki，包括 MoinMoin 都以 文本的形式保存数据，那就无法保存远程图片了。\n经我研究，MoinMoin 中有附件的方法可以保存文件，并且当这种附件存放的是图片文件时， 也可以直接使用 {{attachment:xxx.jpg}} 这样的 Wiki 语法来查看图片。\n我尝试在 MoinMoin 插件库里面找将远程图片本地化的插件未果，于是就花了一个星期左右 时间写了一个实现这样功能的插件 Image2Attach。\n更多使用可以参考这篇文章 MoinMoin plugin: image2attach v0.0.2 released\n所以说，当程序员就是好，功能没有就自己实现呗。\n4. MoinMoin的简单上手 @张刚 同学发邮件给我和我交流了两个问题，我顺便整理到这里。（2011-12-28更新）\n安装语言包 首先请确保当前登录账户是超级用户，超级用户设置在 /usr/share/moin/wikiconfig.py （可能路径有所差异）里面的 superuser = [u\"yourid\"] ，加入你需要设定的用户id 中文界面会根据浏览器语言设定获取，而相应的中文帮助文件默认没有安装，我建议安装。安装步骤如下： 访问http://localhost/LanguageSetup，里面有安装文档链接http://localhost/LanguageSetup?action=language_setup 在http://wiki.localhost/LanguageSetup?action=language_setup中，选择 Simplified_Chinese 点击最下面 all_pages 同时我也建议安装英文版本的 all_pages ，因为中文有一些翻译不全。 更多的中文信息你可以访问MoinMoin主版本中文网站。\n如何加入内容 下面是我自己总结的步骤，目前工作的还不错。\n进入新页面http://localhost/newpage，如果不存在就会创建新页面 默认是文本模式编辑器，切换到图形编辑模式（默认编辑器可以在个人设置里面修改） 从某个网页粘帖内容到图形编辑模式（这个图形编辑器是CKEditor的精简版）。 查看图形编辑器原始码，再返回\"所见即所得\"状态（这个步骤可以去除一些空格） 返回文本模式编辑器，MoinMoin会自动转换html-\u003ewiki（目前我遇到3个bug，中文开头空格/BR换行/fieldset，前两个我已经修 复，diff文件在diff） 人工审核一下wiki，也顺便仔细看看文章内容 加入Category，预览，保存 5. MoinMoin的一些修改 在使用MoinMoin这段时间，我发现了一些小问题，就对源码做了一些小修改。 当然如果你觉得麻烦，不做这些修改也一样可以使用的很好。\n我修改了 /usr/lib/python2.7/site-packages/MoinMoin/converter/text_html_text_moin_wiki.py 这个文件。点击 diff文件下载。\n6. wiz转MoinMoin经验 Wiz中数据存储格式其实是mht，微软的鸟东西，数据转换颇为不方便。\n第一种方法是借助Wiz Web服务，Wiz小组推出的 Web服务 可以很方便的查看所有同步 过的内容，里面就是标准的html代码了，直接可以复制粘帖。Wiz的Web端图片也不用 Cookie认证，取到图片地址就可以抓取了。\n另一种办法就是使用Wiz的导出功能，导出成mht格式， 然后使用MoinMoin站点提供的插件 Word2Moin 脚本进行转换。\n我使用的方法是第一种。\n",
  "wordCount" : "2833",
  "inLanguage": "en",
  "datePublished": "2011-12-26T00:00:00+08:00",
  "dateModified": "2011-12-26T00:00:00+08:00",
  "author":{
    "@type": "Person",
    "name": "alswl"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.alswl.com/2011/12/moinmoin-kms/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Log4D",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.alswl.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.alswl.com" accesskey="h" title="Log4D (Alt + H)">Log4D</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://en.blog.alswl.com/" title="English Blog">
                    <span>English Blog</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/archives/" title="存档">
                    <span>存档</span>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/about/" title="关于我">
                    <span>关于我</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.alswl.com">Home</a>&nbsp;»&nbsp;<a href="https://blog.alswl.com/posts/">Posts</a></div>
    <h1 class="post-title">
      使用MoinMoin作为个人KMS
    </h1>
    <div class="post-meta"><span title='2011-12-26 00:00:00 +0800 +0800'>2011-12-26</span>&nbsp;·&nbsp;alswl

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-关于moinmoin">1. 关于MoinMoin</a></li>
    <li><a href="#2-安装moinmoin">2. 安装MoinMoin</a>
      <ul>
        <li><a href="#21-使用moinmoin桌面版最简单">2.1. 使用MoinMoin桌面版（最简单）</a></li>
        <li><a href="#22-nginxuwsgi方式程序员适用">2.2. nginx+uWsgi方式（程序员适用）</a></li>
      </ul>
    </li>
    <li><a href="#3-image2attach">3. Image2Attach</a></li>
    <li><a href="#4-moinmoin的简单上手">4. MoinMoin的简单上手</a>
      <ul>
        <li><a href="#安装语言包">安装语言包</a></li>
        <li><a href="#如何加入内容">如何加入内容</a></li>
      </ul>
    </li>
    <li><a href="#5-moinmoin的一些修改">5. MoinMoin的一些修改</a></li>
    <li><a href="#6-wiz转moinmoin经验">6. wiz转MoinMoin经验</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>去年9月份时候，我写过一篇《<a href="http://log4d.com/2010/09/my-kms">我所使用的知识管理系统</a>》
来介绍我使用的KMS系统。当时经过我层层筛选之后，我选用了Wiz作为我的KMS。</p>
<p>一年多过去了，Wiz在Windows下面工作的非常不错，Wiz团队里陆续推出了iOS / Android /
<a href="http://service.wiz.cn/web/">Web</a>版本。我的Wiz收藏的内容也增加到近1000篇。</p>
<p>此时我遇到了KMS再选型的问题，原因很简单：我全线转换到Linux平台， Wiz不符合我的要求了。</p>
<p>我重新整理一下我要求KMS的特性：</p>
<ul>
<li>跨平台：Linux / Web / iOS / Android / Windows</li>
<li>数据保存格式：移植方便，将图片保存到本地</li>
<li>数据采集方式：支持网络直接拷贝复制</li>
<li>数据索引：支持分类 + tag</li>
<li>协同工作：方便的分享机制</li>
<li>免费</li>
</ul>
<p>经过我历时N月的搜寻筛选，MoinMoin Wiki中标了！</p>
<h2 id="1-关于moinmoin">1. 关于MoinMoin<a hidden class="anchor" aria-hidden="true" href="#1-关于moinmoin">#</a></h2>
<p>MoinMoin是使用Python编写的Wiki实现，MoinMoin当前版本1.9。</p>
<p>MoinMoin的优点是：</p>
<ul>
<li>安装简单;</li>
<li>支持中文全文检索；</li>
<li>汉化较好；</li>
<li>不依赖外界的数据库, 使用纯文本保存, 备份非常容易, 直接复制即可。</li>
<li>支持从html转换到MoinMoin Wiki格式，纯文本的wiki格式比html来的更纯粹，只保存需要的数据，而不保存冗余的样式，MoinMoin这点做的非常好，支持几乎全部html标记的转换。</li>
</ul>
<h2 id="2-安装moinmoin">2. 安装MoinMoin<a hidden class="anchor" aria-hidden="true" href="#2-安装moinmoin">#</a></h2>
<p>MoinMoin基于Python，因此安装比基于php的MediaWiki麻烦一点。</p>
<p>你也可以参考<a href="http://moinmo.in/HowTo">官方安装指导（英文）</a>，里面有 Ubuntu / CentOS / SuSE
等系统的安装方法。</p>
<h3 id="21-使用moinmoin桌面版最简单">2.1. 使用MoinMoin桌面版（最简单）<a hidden class="anchor" aria-hidden="true" href="#21-使用moinmoin桌面版最简单">#</a></h3>
<p>好在有MoinMoin下载包里面包含了简单的可执行版本，只需3个步骤就可以运行了。</p>
<ol>
<li>下载 MoinMoin <a href="https://moinmo.in/MoinMoinDownload">MoinMoinDownload - MoinMoin</a></li>
<li>解压缩到合适的目录（安装目录）</li>
<li>运行目录下面的 <code>wikiserver.py</code>
<ol>
<li>Linux/Unix：在命令行里面运行 <code>wikiserver.py</code></li>
<li>Mac：在 <code>wikiserver.py</code> 上面点击右键，选择 <code>open with...</code> - <code>All Applications</code> - <code>Always Open With</code> - <code>Terminal.app</code></li>
<li>Windows：下载 <a href="http://www.python.org/download/">Python</a> （2.5-2.6）， 安装之后双击 <code>wikiserver.py</code> 运行。</li>
</ol>
</li>
</ol>
<p>安装好之后，打开浏览器，在地址栏输入 <a href="http://localhost:8080/">http://localhost:8080/</a> 即可访问。</p>
<p>PS：如果你将MoinMoin安装的优盘，甚至可以做成移动知识库哦~</p>
<p>更多可以参考 <a href="http://moinmo.in/DesktopEdition">官方DesktopEdition帮助文档（英文）</a></p>
<h3 id="22-nginxuwsgi方式程序员适用">2.2. nginx+uWsgi方式（程序员适用）<a hidden class="anchor" aria-hidden="true" href="#22-nginxuwsgi方式程序员适用">#</a></h3>
<p><code>wikiserver.py</code> 虽然可以运行，但是作为开发者，我当然要使用效率更高的方式。 运行Python Web应用需要
<code>Appach / ngnix + CGI / FastCGI / uWSGI</code> 环境。 我这里使用nginx + uWSGI进行环境配置。</p>
<p>Google了N多资料之后，这篇 <a href="http://typedef.me/2011/08/30/archlinux-nginx-uwsgi-moinmoin-setup">ArchLinux 下使用 Nginx + uWSGI 部署 MoinMoin</a>
最是详细，另外还可以参考 <a href="http://garfileo.is-programmer.com/2011/4/24/run-moinmoin-on-uwsgi-and-nginx.26347.html">运行在 nginx 与 uwsgi 之上的 moinmoin</a>。</p>
<p>我将主要步骤和我的一些修改列出来。</p>
<h4 id="221-安装需要软件">2.2.1. 安装需要软件<a hidden class="anchor" aria-hidden="true" href="#221-安装需要软件">#</a></h4>
<p>我当前系统是Arch，运行一下命令安装，其他系统也类似</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pacman -S nginx moinmoin
</span></span><span class="line"><span class="cl">yaourt uwsgi
</span></span></code></pre></div><h4 id="222-配置moinmoin">2.2.2. 配置MoinMoin<a hidden class="anchor" aria-hidden="true" href="#222-配置moinmoin">#</a></h4>
<p>默认情况下，moinmoin 被安装在了 <code>/usr/lib/python2.7/site-packages/MoinMoin</code> 和
<code>/usr/moin/share</code> 这两个目录下。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /usr/share/moin/
</span></span><span class="line"><span class="cl">ln -s /usr/share/moin/server/moin.wsgi .
</span></span><span class="line"><span class="cl">ln -s /usr/share/moin/config/wikiconfig.py .
</span></span></code></pre></div><h4 id="223-配置nginx">2.2.3. 配置nginx<a hidden class="anchor" aria-hidden="true" href="#223-配置nginx">#</a></h4>
<p>在上文的基础上，我做了一些小修改，我的nginx站点配置如下，我没有使用端口9090 作为uwsgi的监听端口，而是使用了UNIX
Sock，这样相对安全一些。</p>
<p>ps：貌似这个版本的uwsgi 0.9.9.2有点小问题，无法在 <code>/var/run</code> 里面创建sock， 我只能将 <code>uwsgi.sock</code> 放在
<code>/tmp</code> 里面</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span>       <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span>  <span class="s">wiki.localhost</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kn">include</span> <span class="s">uwsgi_params</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">#uwsgi_pass 127.0.0.1:9090;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kn">uwsgi_pass</span> <span class="s">unix:/tmp/uwsgi.sock</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="kn">uwsgi_param</span> <span class="s">UWSGI_PYHOME</span> <span class="s">/usr/lib/python2.7/site-packages/MoinMoin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="kn">uwsgi_param</span> <span class="s">UWSGI_CHDIR</span> <span class="s">/usr/share/moin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="kn">uwsgi_param</span> <span class="s">UWSGI_SCRIPT</span> <span class="s">moin_wsgi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># vim: set ft=conf:
</span></span></span></code></pre></div><h4 id="224-配置启动文件">2.2.4. 配置启动文件<a hidden class="anchor" aria-hidden="true" href="#224-配置启动文件">#</a></h4>
<p>因为使用 UNIX Sock 连接，所以 <code>/etc/rc.d/uwsgi</code> 启动文件也略做修改（ Ubunt 的启动配置文件在
<code>/etc/init.d/</code> 下面）， 加入了 <code>SOCK</code> ，同时我为 uwsgi 指定运行用户 <code>http</code> ，避免root启动带来的安全隐患。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">#PORT=9090</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">SOCK</span><span class="o">=</span>/tmp/uwsgi.sock
</span></span><span class="line"><span class="cl"><span class="nv">PROCESSES</span><span class="o">=</span><span class="m">4</span>
</span></span><span class="line"><span class="cl"><span class="nv">USER</span><span class="o">=</span><span class="nv">httpLOG</span><span class="o">=</span>/var/log/uwsgi.log
</span></span><span class="line"><span class="cl"><span class="nv">PID</span><span class="o">=</span><span class="sb">`</span>pidof -o %PPID /usr/bin/uwsgi<span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">. /etc/rc.conf
</span></span><span class="line"><span class="cl">. /etc/rc.d/functions
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">	start<span class="o">)</span>
</span></span><span class="line"><span class="cl">		stat_busy <span class="s2">&#34;Starting uwsgi&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$PID</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			stat_busy <span class="s2">&#34;uwsgi is already running&#34;</span>
</span></span><span class="line"><span class="cl">			stat_die
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">			<span class="c1">#uwsgi --uid $USER -s &#34;:$PORT&#34; -M -p $PROCESSES -d $LOG &amp;&gt; /dev/null # use socket port</span>
</span></span><span class="line"><span class="cl">			uwsgi --uid <span class="nv">$USER</span> --socket <span class="nv">$SOCK</span> -M -p <span class="nv">$PROCESSES</span> -d <span class="nv">$LOG</span> <span class="p">&amp;</span>&gt; /dev/null <span class="c1"># use unix sock</span>
</span></span><span class="line"><span class="cl">			add_daemon uwsgi
</span></span><span class="line"><span class="cl">			stat_done
</span></span><span class="line"><span class="cl">		<span class="k">fi</span>
</span></span><span class="line"><span class="cl">		<span class="p">;;</span>
</span></span><span class="line"><span class="cl">	stop<span class="o">)</span>
</span></span><span class="line"><span class="cl">		stat_busy <span class="s2">&#34;Stopping uwsgi&#34;</span>
</span></span><span class="line"><span class="cl">		killall -QUIT uwsgi <span class="p">&amp;</span>&gt; /dev/null
</span></span><span class="line"><span class="cl">		rm_daemon uwsgi
</span></span><span class="line"><span class="cl">		stat_done
</span></span><span class="line"><span class="cl">		<span class="p">;;</span>
</span></span><span class="line"><span class="cl">	restart<span class="o">)</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$0</span> stop
</span></span><span class="line"><span class="cl">		sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$0</span> start
</span></span><span class="line"><span class="cl">		<span class="p">;;</span>
</span></span><span class="line"><span class="cl">	*<span class="o">)</span>
</span></span><span class="line"><span class="cl">		<span class="nb">echo</span> <span class="s2">&#34;usage: </span><span class="nv">$0</span><span class="s2"> {start|stop|restart}&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">esac</span>
</span></span><span class="line"><span class="cl"><span class="nb">exit</span> <span class="m">0</span>
</span></span></code></pre></div><h2 id="3-image2attach">3. Image2Attach<a hidden class="anchor" aria-hidden="true" href="#3-image2attach">#</a></h2>
<p>去年我选择Wiz而不选择Wiki类产品时候，是考虑到一个图片保存本地化的问题。 即保存一篇网页时候，要将里面的图片保存到本地，而不是使用链接方式保存，
因为由于各种不可预测的原因，原始图片数据很有可能丢失或者无法连接。</p>
<p>Wiz使用的方案是使用mht格式将图片保存在问题，而大部分 Wiki，包括 MoinMoin 都以 文本的形式保存数据，那就无法保存远程图片了。</p>
<p>经我研究，MoinMoin 中有附件的方法可以保存文件，并且当这种附件存放的是图片文件时， 也可以直接使用 <code>{{attachment:xxx.jpg}}</code>
这样的 Wiki 语法来查看图片。</p>
<p>我尝试在 MoinMoin 插件库里面找将远程图片本地化的插件未果，于是就花了一个星期左右 时间写了一个实现这样功能的插件 Image2Attach。</p>
<p>更多使用可以参考这篇文章 <a href="http://log4d.com/2011/12/moinmoin-plugin-image2attach">MoinMoin plugin: image2attach v0.0.2 released</a></p>
<p>所以说，当程序员就是好，功能没有就自己实现呗。</p>
<h2 id="4-moinmoin的简单上手">4. MoinMoin的简单上手<a hidden class="anchor" aria-hidden="true" href="#4-moinmoin的简单上手">#</a></h2>
<p><a href="http://zhanggang.net/">@张刚</a> 同学发邮件给我和我交流了两个问题，我顺便整理到这里。（2011-12-28更新）</p>
<h3 id="安装语言包">安装语言包<a hidden class="anchor" aria-hidden="true" href="#安装语言包">#</a></h3>
<ul>
<li>首先请确保当前登录账户是超级用户，超级用户设置在 <code>/usr/share/moin/wikiconfig.py</code> （可能路径有所差异）里面的 <code>superuser = [u&quot;yourid&quot;]</code> ，加入你需要设定的用户id</li>
<li>中文界面会根据浏览器语言设定获取，而相应的中文帮助文件默认没有安装，我建议安装。安装步骤如下：
<ul>
<li>访问http://localhost/LanguageSetup，里面有安装文档链接http://localhost/LanguageSetup?action=language_setup</li>
<li>在http://wiki.localhost/LanguageSetup?action=language_setup中，选择 <code>Simplified_Chinese</code> 点击最下面 <code>all_pages</code></li>
<li>同时我也建议安装英文版本的 <code>all_pages</code> ，因为中文有一些翻译不全。</li>
</ul>
</li>
</ul>
<p>更多的中文信息你可以访问<a href="http://master.moinmo.in/%E9%A6%96%E9%A1%B5">MoinMoin主版本中文网站</a>。</p>
<h3 id="如何加入内容">如何加入内容<a hidden class="anchor" aria-hidden="true" href="#如何加入内容">#</a></h3>
<p>下面是我自己总结的步骤，目前工作的还不错。</p>
<ul>
<li>进入新页面http://localhost/newpage，如果不存在就会创建新页面</li>
<li>默认是文本模式编辑器，切换到图形编辑模式（默认编辑器可以在个人设置里面修改）</li>
<li>从某个网页粘帖内容到图形编辑模式（这个图形编辑器是CKEditor的精简版）。</li>
<li>查看图形编辑器原始码，再返回&quot;所见即所得&quot;状态（这个步骤可以去除一些空格）</li>
<li>返回文本模式编辑器，MoinMoin会自动转换html-&gt;wiki（目前我遇到3个bug，中文开头空格/BR换行/fieldset，前两个我已经修 复，diff文件在<a href="../../static/images/upload_dropbox/201112/moinmoin.diff">diff</a>）</li>
<li>人工审核一下wiki，也顺便仔细看看文章内容</li>
<li>加入Category，预览，保存</li>
</ul>
<h2 id="5-moinmoin的一些修改">5. MoinMoin的一些修改<a hidden class="anchor" aria-hidden="true" href="#5-moinmoin的一些修改">#</a></h2>
<p>在使用MoinMoin这段时间，我发现了一些小问题，就对源码做了一些小修改。 当然如果你觉得麻烦，不做这些修改也一样可以使用的很好。</p>
<p>我修改了 <code>/usr/lib/python2.7/site-packages/MoinMoin/converter/text_html_text_moin_wiki.py</code> 这个文件。点击 <a href="../../static/images/upload_dropbox/201112/moinmoin.diff">diff文件</a>下载。</p>
<h2 id="6-wiz转moinmoin经验">6. wiz转MoinMoin经验<a hidden class="anchor" aria-hidden="true" href="#6-wiz转moinmoin经验">#</a></h2>
<p>Wiz中数据存储格式其实是mht，微软的鸟东西，数据转换颇为不方便。</p>
<p>第一种方法是借助Wiz Web服务，Wiz小组推出的 <a href="http://service.wiz.cn/web">Web服务</a> 可以很方便的查看所有同步
过的内容，里面就是标准的html代码了，直接可以复制粘帖。Wiz的Web端图片也不用 Cookie认证，取到图片地址就可以抓取了。</p>
<p>另一种办法就是使用Wiz的导出功能，导出成mht格式， 然后使用MoinMoin站点提供的插件
<a href="http://moinmo.in/MicrosoftWordConverter">Word2Moin</a> 脚本进行转换。</p>
<p>我使用的方法是第一种。</p>

<hr />
<p>原文链接: <a href="https://blog.alswl.com/2011/12/moinmoin-kms/">使用MoinMoin作为个人KMS | Log4D</a></p>
<p>3a1ff193cee606bd1e2ea554a16353ee</p>
<p>欢迎关注我的微信公众号：<a
href="http://mp.weixin.qq.com/mp/getmasssendmsg?__biz=MzIyNTIwMTU3MQ==#wechat_webview_type=1&amp;wechat_redirect">窥豹</a></p>
<figure>
<img
src="https://4ocf5n.dijingchao.com/upload_dropbox/201605/qrcode_for_gh_17e2f9c2caa4_258.jpg"
alt="窥豹" />
<figcaption aria-hidden="true">窥豹</figcaption>
</figure>
<figure>
<img
src="https://4ocf5n.dijingchao.com/upload_dropbox/meta/wechat-pay-s-crop.png"
alt="如果对你有帮助，给作者 ￥2 买张彩票吧。" />
<figcaption aria-hidden="true">如果对你有帮助，给作者 ￥2
买张彩票吧。</figcaption>
</figure>

    
  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.alswl.com/tags/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/">工欲善其事必先利其器</a></li>
      <li><a href="https://blog.alswl.com/tags/image2attach/">image2attach</a></li>
      <li><a href="https://blog.alswl.com/tags/kms/">kms</a></li>
      <li><a href="https://blog.alswl.com/tags/moinmoin/">moinmoin</a></li>
      <li><a href="https://blog.alswl.com/tags/nginx/">nginx</a></li>
      <li><a href="https://blog.alswl.com/tags/uwsgi/">uwsgi</a></li>
      <li><a href="https://blog.alswl.com/tags/wiz/">wiz</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://blog.alswl.com/2011/12/my-2011/">
    <span class="title">« Prev</span>
    <br>
    <span>My 2011</span>
  </a>
  <a class="next" href="https://blog.alswl.com/2011/12/moinmoin-plugin-image2attach/">
    <span class="title">Next »</span>
    <br>
    <span>MoinMoin plugin: image2attach</span>
  </a>
</nav>

  </footer><div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "log4d" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://blog.alswl.com">Log4D</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
