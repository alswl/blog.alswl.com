<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>AzaAjaxChat笔记-实现 - Log4D</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="block-all-mixed-content">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />



<link rel="canonical" href="https://blog.alswl.com/2010/08/azaajaxchat-notes-implementation/">

        <meta name="author" content="alswl" />
        <meta name="keywords" content="PHP,AzaAjaxChat,Comet,Flex,FMS,JavaScript,RTMP" />
        <meta name="description" content="唔，继续整理笔记，这些是在代码编写中遇到的问题和解决办法的总结，不是Turtial，问题有针对性，内容枯燥，路人可以直接忽略 …" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css"/>
    <link href="https://cdn.staticfile.org/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.alswl.com/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.alswl.com/theme/css/style.css" type="text/css"/>

    <link href="https://blog.alswl.com/atom.xml" type="application/atom+xml" rel="alternate" title="Log4D Atom Feed" />
    <link href="https://blog.alswl.com/rss.xml" type="application/rss+xml" rel="alternate" title="Log4D RSS Feed" />

</head>
<body>

<div class="navbar navbar-default" role="navigation">
    <div class="container  col-lg-8 col-lg-offset-2">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.alswl.com/" class="navbar-brand">
Log4D            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/tags/">Tags</a></li>
                    <li><a href="/links/">Links</a></li>
                    <li><a href="/about/">About</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="https://blog.alswl.com/archives/"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2">

    <section id="content">
        <article class="article-detail">
            <header class="page-header">
                <h1 class="title">
                    <a href="https://blog.alswl.com/2010/08/azaajaxchat-notes-implementation/"
                       rel="bookmark"
                       title="Permalink to AzaAjaxChat笔记-实现">
                        AzaAjaxChat笔记-实现
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2010-08-22T00:00:00+08:00"> 2010-08-22</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="https://blog.alswl.com/tag/php/">PHP</a>
        /
	<a href="https://blog.alswl.com/tag/azaajaxchat/">AzaAjaxChat</a>
        /
	<a href="https://blog.alswl.com/tag/comet/">Comet</a>
        /
	<a href="https://blog.alswl.com/tag/flex/">Flex</a>
        /
	<a href="https://blog.alswl.com/tag/fms/">FMS</a>
        /
	<a href="https://blog.alswl.com/tag/javascript/">JavaScript</a>
        /
	<a href="https://blog.alswl.com/tag/rtmp/">RTMP</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>唔，继续整理笔记，这些是在代码编写中遇到的问题和解决办法的总结，不是Turtial，问题有针对性，内容枯燥，路人可以直接忽略~</p>
<h3 id="一comet服务器推技术">一、Comet服务器推技术</h3>
<p>Comet推技术，一句话概括，就是形成一个不断开的连接，使得服务器能主动向客户端发送信息。这种技术在交互性强的Web产品中应用的非常多，比如GMail。Co met的实现方式有两种：基于 AJAX 的长轮询（long-polling）方式和基于 Iframe 及 htmlfile 的流（streaming）方式，具体两种实现方式可以参考<a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/">Comet：基于 HTTP 长连接的“服务器推”技术</a>。</p>
<p>我计划把这个技术引入，成为一个亮点，第二种Comet实现方式过于复杂（GMail使用的就是这种），我就尝试第一种。我在测试环境测试了基于 AJAX 的长轮询 （long-polling）方式。这种方式说白了就是在Ajax获取返回数据时候，在状态吗为4（数据传输完成）情况随后进行下次查询。进行循环的查询。</p>
<p>这种Long-polling的轮询方式有点伪Comet。相对于常见的定时查询，不同点是将“查询-&gt;返回-&gt;再查询”中间的一段断开时间进行重连接。最后因为技术 实现和开发时间，我决定放弃了Comet的实现。</p>
<p>PS：一个系统应该不仅仅是技术的堆积，也应该考虑其他的一些因素，是否有确实需求，开发效率问题。虽然我做了一些前期准备，最终还是没有加入Comet，蛮可惜的。</p>
<h4 id="相关链接">相关链接：</h4>
<ul>
<li><a href="http://www.javaeye.com/topic/652949">一步一步打造WebIM（1） - .net - dotnet - JavaEye论坛</a>（.net使用IHttpAsyncHandler的实现）</li>
<li><a href="http://ued.sohu.com/article/118/comment-page-1">Comet–“服务器推”技术 - 搜狐UED</a>（搜狐UED团队的一个小介绍）</li>
</ul>
<h3 id="二用户状态的处理">二、用户状态的处理</h3>
<p>开发时候遇到一个逻辑问题，具体描述如下：“一个用户登录长时间不活动（比如直接关闭浏览器），系统需要判定此用户为离线。”按照一般设计思路，这个动作应该由后台每 过一段时间自动（比如说5分钟）触发一次，如果用Java或.net实现，会考虑设计一个后台运行的进程进行管理。而现在用的PHP，我查了一下，似乎没有找到相应的 解决办法。</p>
<p>我尝试在系统中设定一个页面每隔几分钟触发一个动作，放置在index.php页面中，但是感觉这个设计有点鸡肋。</p>
<p>这个问题困惑我很久，最后参考了<a href="https://blueimp.net/ajax/">AJAX Chat</a>的源码，它的思路是在一个新用户上线时候，进行检测所 有用户距离上次其活动的时间来判定每个用户的离线状态。这个也不是最优想法（万一长时间没有用户登录怎么办？），但是比上面那个定时页面要好多了。</p>
<p>如果有PHP达人看到这个，望不惜赐教。</p>
<h3 id="三rtmp">三、RTMP</h3>
<p>RTPM是一个流媒体传输的协议，我在AzaAjaxChat中用它进行视频聊天画面和音频传输。这块内容可以洋洋洒洒的写一大篇日志，我在这里只是简单罗列一下我用 到的相关内容。</p>
<blockquote>
<p>Real Time Messaging Protocol（实时消息传送协议协议)概述，实时消息传送协议是Adobe Systems公司为Flash播放器和服务器之间音频、视频和数据传输开发的私有协议。它有三种变种： 1)工作在TCP之上的明文协议，使用端口1935； 2)RTMPT封装在HTTP请求之中，可穿越防火墙； 3)RTMPS类似RTMPT，但使用的是HTTPS连接；</p>
<p>RTMP协议是被Flash用于对象，视频,音频的传输.该协议建立在TCP协议或者轮询 HTTP协议之上。</p>
<p>RTMP协议就像一个用来装数据包的容器，这些数据可以是AMF格式的数据，也可以是FLV中的视/音频数据。一个单一的连接可以通过不同的通道传输多路网络流。 这些通道中的包都是按照固定大小的包传输的。</p>
</blockquote>
<p>我使用FMS作为RTPM容器，Adobe FMS（Flash Media Server）是一款能够提供出色的Flash Video流媒体播放功能的服务器软件。</p>
<p>FMS提供一个强大Script可定制脚本的服务器流媒体引擎，通过这个引擎，允许创建和交付面向互联网任何用户群体的交互媒体应用及服务。FMS还是Adobe公司 跨媒体解决方案中的一部分，针对诸如数据库连接访问、文件系统操作、服务访问等要求，可以同Adobe Flash Player与Adobe AIR一起来实现。</p>
<h3 id="四基于flex的流媒体传输">四、基于Flex的流媒体传输</h3>
<h4 id="官方sample-stratus">4.1 官方Sample-Stratus</h4>
<p>AzaAjaxChat中最技术含量的地方在于语音视频聊天。Adobe官网在Flex子类中提供了一个Demo名叫<a href="http://labs.a%20dobe.com/technologies/stratus/samples/">Stratus</a>，正是一个聊天系统。从教程上看，Adobe公司目前开放的Stratus是同时支 持视频和语音P2P的，同时，未来的FMS也可能会支持P2P。</p>
<p>Adobe的某个专家博客还针对Stratus有一篇相当详细的讲解，原文在此<a href="http://www.adobe.com/devnet/flashplayer/articles/rtmfp_stratus_app.html">Stratus service for developing end-to- end applications using RTMFP in Flash Player 10 | Adobe Developer Connection</a>，文中分析了 RTMFP（比RTMP更高阶的流媒体传输协议，支持P2P）和Stratus的相关核心代码。我本想把这篇文章翻译，完成10%之后，意外发现已经有人翻译了，地址 在此<a href="http://snowyrock.spaces.live.com/Blog/cns!B8CBEB7169880B1D!1279.entry?wa=wsignin1.0&amp;sa=18%203740112">通过Stratus 服务器在Flash Player中使用RTMFP 开发 点对点应用(一) – Windows Live</a>，<a href="http://snowyrock.spaces.live.com/blog/cns!B8CBEB7169880B1D!1278.entry?_c=BlogPart">通过Stratus 服务器在Flash Player中使用RTMFP 开发 点对点应用（二） – Windows Live</a> 。</p>
<p>同时可以参考其他例子<a href="http://www.cnblogs.com/beniao/archive/2009/04/28/1444159.html">FMS3系列(五)：通过FMS实现时时视频聊天（Flash|Flex） - Bēniaǒ成长笔记 - 博客园</a>。</p>
<h4 id="azaajaxchat视频语音核心代码">4.2 AzaAjaxChat视频语音核心代码</h4>
<p>下面是核心代码。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">&lt;?php</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">protected</span> <span class="kw">function</span> starChat<span class="ot">(</span>event:MouseEvent<span class="ot">)</span>:<span class="kw">void</span> {</a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="co">//同时开始监听</span></a>
<a class="sourceLine" id="cb1-4" title="4">    doReceive<span class="ot">();</span></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="co">//初始化一个网络连接 </span></a>
<a class="sourceLine" id="cb1-6" title="6">    publicNc = <span class="kw">new</span> NetConnection<span class="ot">();</span></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="co">//开始连接 </span></a>
<a class="sourceLine" id="cb1-8" title="8">    publicNc.connect<span class="ot">(</span>rtmpUrl<span class="ot">);</span> </a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="co">//为这个连接添加事件,这个事件有返回连接状态 </span></a>
<a class="sourceLine" id="cb1-10" title="10">    publicNc.addEventListener<span class="ot">(</span>NetStatusEvent.<span class="kw">NET_STATUS</span><span class="ot">,</span>onPublishNetStatusHandler<span class="ot">);</span> </a>
<a class="sourceLine" id="cb1-11" title="11">    microphone = Microphone.getMicrophone<span class="ot">();</span></a>
<a class="sourceLine" id="cb1-12" title="12">    camera = Camera.getCamera<span class="ot">();</span></a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="kw">if</span><span class="ot">(</span>!camera<span class="ot">)</span> {</a>
<a class="sourceLine" id="cb1-14" title="14">        Alert.show<span class="ot">(</span><span class="st">&#39;没有开启摄像头或者没有安装摄像头&#39;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb1-15" title="15">    } <span class="kw">else</span> {</a>
<a class="sourceLine" id="cb1-16" title="16">        this.videoPublish.attachCamera<span class="ot">(</span>camera<span class="ot">);</span></a>
<a class="sourceLine" id="cb1-17" title="17">    }</a>
<a class="sourceLine" id="cb1-18" title="18">}</a>
<a class="sourceLine" id="cb1-19" title="19"></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="kw">private</span> <span class="kw">function</span> onPublishNetStatusHandler<span class="ot">(</span>event:NetStatusEvent<span class="ot">)</span>:<span class="kw">void</span> {</a>
<a class="sourceLine" id="cb1-21" title="21"></a>
<a class="sourceLine" id="cb1-22" title="22">    <span class="co">//根据连接返回的状态信息判断是滞连接成功</span></a>
<a class="sourceLine" id="cb1-23" title="23">    <span class="kw">if</span><span class="ot">(</span>event.info.code==<span class="st">&quot;NetConnection.Connect.Success&quot;</span><span class="ot">)</span>{</a>
<a class="sourceLine" id="cb1-24" title="24">        appMessage.text += <span class="st">&quot;n发布连接建立成功&quot;</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb1-25" title="25">        publicNs = <span class="kw">new</span> NetStream<span class="ot">(</span>publicNc<span class="ot">);</span></a>
<a class="sourceLine" id="cb1-26" title="26">        publicNs.attachAudio<span class="ot">(</span>microphone<span class="ot">);</span></a>
<a class="sourceLine" id="cb1-27" title="27">        publicNs.attachCamera<span class="ot">(</span>camera<span class="ot">);</span></a>
<a class="sourceLine" id="cb1-28" title="28">        publicNs.client = this<span class="ot">;</span></a>
<a class="sourceLine" id="cb1-29" title="29">        publicNs.publish<span class="ot">(</span>publicName<span class="ot">,</span><span class="st">&quot;live&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb1-30" title="30">    }</a>
<a class="sourceLine" id="cb1-31" title="31">}</a>
<a class="sourceLine" id="cb1-32" title="32"></a>
<a class="sourceLine" id="cb1-33" title="33"><span class="kw">private</span> <span class="kw">function</span> doReceive<span class="ot">()</span>:<span class="kw">void</span> {</a>
<a class="sourceLine" id="cb1-34" title="34">    receiveNc = <span class="kw">new</span> NetConnection<span class="ot">();</span></a>
<a class="sourceLine" id="cb1-35" title="35">    <span class="co">//开始连接</span></a>
<a class="sourceLine" id="cb1-36" title="36">    receiveNc.connect<span class="ot">(</span>rtmpUrl<span class="ot">);</span></a>
<a class="sourceLine" id="cb1-37" title="37">    <span class="co">//为这个连接添加事件,这个事件有返回连接状态</span></a>
<a class="sourceLine" id="cb1-38" title="38">    receiveNc.addEventListener<span class="ot">(</span>NetStatusEvent.<span class="kw">NET_STATUS</span><span class="ot">,</span>onReceiveNetStatusHandler<span class="ot">);</span></a>
<a class="sourceLine" id="cb1-39" title="39"></a>
<a class="sourceLine" id="cb1-40" title="40">}</a>
<a class="sourceLine" id="cb1-41" title="41"></a>
<a class="sourceLine" id="cb1-42" title="42"><span class="kw">private</span> <span class="kw">function</span> onReceiveNetStatusHandler<span class="ot">(</span>event:NetStatusEvent<span class="ot">)</span>:<span class="kw">void</span> {</a>
<a class="sourceLine" id="cb1-43" title="43">    <span class="co">//根据连接返回的状态信息判断是滞连接成功</span></a>
<a class="sourceLine" id="cb1-44" title="44">    <span class="kw">if</span><span class="ot">(</span>event.info.code==<span class="st">&quot;NetConnection.Connect.Success&quot;</span><span class="ot">)</span>{</a>
<a class="sourceLine" id="cb1-45" title="45">        appMessage.text += <span class="st">&quot;n接受连接建立成功&quot;</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb1-46" title="46">        receiveNs = <span class="kw">new</span> NetStream<span class="ot">(</span>publicNc<span class="ot">);</span></a>
<a class="sourceLine" id="cb1-47" title="47">        video = <span class="kw">new</span> Video<span class="ot">();</span></a>
<a class="sourceLine" id="cb1-48" title="48">        video.width = <span class="dv">230</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb1-49" title="49">        video.height = <span class="dv">173</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb1-50" title="50">        video.attachNetStream<span class="ot">(</span>receiveNs<span class="ot">);</span></a>
<a class="sourceLine" id="cb1-51" title="51">        this.videoReceive.addChild<span class="ot">(</span>video<span class="ot">);</span></a>
<a class="sourceLine" id="cb1-52" title="52">        receiveNs.play<span class="ot">(</span>receiveName<span class="ot">,</span><span class="st">&quot;live&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb1-53" title="53">    } <span class="kw">else</span> {</a>
<a class="sourceLine" id="cb1-54" title="54">        appMessage.text += <span class="st">&quot;n&quot;</span> +　event.info.code<span class="ot">;</span></a>
<a class="sourceLine" id="cb1-55" title="55">    }</a>
<a class="sourceLine" id="cb1-56" title="56">}</a>
<a class="sourceLine" id="cb1-57" title="57"></a>
<a class="sourceLine" id="cb1-58" title="58"><span class="kw">?&gt;</span></a></code></pre></div>
<h4 id="管道netconnection.connect">4.3 管道NetConnection.connect()</h4>
<p>Flex流媒体传输通过通道传输，在NetConnection之上建立连接，由于RTMP和FMS的存在，我们可以很方便的在网络流上写入和读取流媒体信息。Net Connection.connect()支持FMS流媒体和本地文件，官方解释如下。</p>
<blockquote>
<p>在 Flash Player 或 AIR AIR 应用程序和 Flash Media Server 应用程序之间创建双向连接,NetConnection 对象如同客户端与服务器之间的管道。</p>
<p>如果未使用 Flash Media Server，请调用 NetConnection.connect()，以便从本地文件系统或 Web</p>
</blockquote>
<p>服务器中播放视频和 MP3 文件。有关支持的编解码器和文件格式的信息，请参阅 <a href="http://www.adobe.com/go/hardware_scaling_cn">http://www.adobe.com/go/hardware_scali ng_cn</a>。</p>
<h4 id="flash.net.netconnection-上找不到属性-onbwdone">4.4 flash.net.NetConnection 上找不到属性 onBWDone</h4>
<p>这个问题参考<a href="http://blog.csdn.net/xiang08/archive/2009/07/13/4343551.aspx">在 flash.net.NetConnection 上找不到属性 onBWDone，且没有默认值。解决办法。 - Xiang - CSDN博客</a>，解决如下。</p>
<blockquote>
<p>在 flash.net.NetConnection 上找不到属性 onBWDone，且没有默认值。</p>
<pre><code>_nc = new NetConnection();
c.addEventListener(NetStatusEvent.NET_STATUS,netStatusHandler);
c.client = this;
c.objectEncoding = ObjectEncoding.AMF0;
c.connect(&quot;rtmp://localhost/oflaDemo&quot;);</code></pre>
<p>首先添加_nc.client = this.</p>
<p>然后新建一个方法：public function onBWDone():void{}</p>
<p>问题解决。</p>
</blockquote>
<h3 id="五javascript和flex的交互">五、JavaScript和Flex的交互</h3>
<p>页面上的Flex必须响应页面JavaScript的触发事件，Adboe在设计Flex时候，预留了相互调用的端口ExternalInterface，详情可以Google之，类似代码如下。</p>
<pre><code>if (ExternalInterface.available) {
    ExternalInterface.addCallback(&quot;initParams&quot;, initParams);
    ExternalInterface.addCallback(&quot;playSound&quot;, playSound);
} else {
    this.appMessage.text += &quot;nJS无法调用Flash，请检查Flash环境&quot;;
}</code></pre>
<p>但是这种调用方法存在着一个致命的问题：创建一个swf的Object，当对这个swf做隐藏/显示的时候(display:none,display:block) 的时候，swf的所有的注册的javascritp函数都会被干掉(ExternalInterface.addCall方法)。这个是Flex的一个BUG，现在也 还没有解决。</p>
<p>相关讨论可以参见<a href="http://rwl6813021.javaeye.com/blog/236344">Javascript无法访问Flex问题~ - rwl6813021 - JavaEye技术网站</a>，文中详细讨论了这个问题，并给出一个解决方案。</p>
<p>有一个折中的方案：即通过LocationConnection(本地通讯,利用两个swf来进行交互)来处理，初始化一个调用的client swf，负责调用被隐藏的swf中的方法，这样就避开了直接通过javascript调用被隐藏的swf中的方法。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb4-1" title="1"><span class="co">//1：client 发送端:</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">private</span> var ucallswfconn:LocalConnection;</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">public</span> function <span class="fu">init</span>():<span class="dt">void</span> {</a>
<a class="sourceLine" id="cb4-4" title="4">    ucallswfconn = <span class="kw">new</span> <span class="fu">LocalConnection</span>();</a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="co">//注册Javascritp方法，网页调用该flex的方法，通过该方法中转，调用另外一个flex的方法</span></a>
<a class="sourceLine" id="cb4-6" title="6">    ExternalInterface.<span class="fu">addCallback</span>(<span class="st">&quot;selectCallControl&quot;</span>,flexSelectCallControl);</a>
<a class="sourceLine" id="cb4-7" title="7">}</a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="kw">public</span> function <span class="fu">flexSelectCallControl</span>(method:<span class="bu">String</span>,param:<span class="bu">String</span>):<span class="dt">void</span> {</a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="co">//Alert.show(method+param);</span></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="co">//调用另外一端swf中的方法，参数：1:receiver端监听的服务名称 2:方法名称 3:参数</span></a>
<a class="sourceLine" id="cb4-12" title="12">    ucallswfconn.<span class="fu">send</span>(<span class="st">&quot;ucallexternconn&quot;</span>,<span class="st">&quot;&quot;</span>+method,<span class="st">&quot;&quot;</span>+param);</a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14">}</a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">//2：receiver 接收端：</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">//add by polarbear, 2008.09.04, 本地通讯</span></a>
<a class="sourceLine" id="cb4-18" title="18"></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="kw">this</span>.<span class="fu">ucallexternConn</span> = <span class="kw">new</span> <span class="fu">LocalConnection</span>();</a>
<a class="sourceLine" id="cb4-20" title="20"><span class="kw">this</span>.<span class="fu">ucallexternConn</span>.<span class="fu">allowDomain</span>(<span class="st">&quot;*&quot;</span>);</a>
<a class="sourceLine" id="cb4-21" title="21">ucallexternConn.<span class="fu">client</span> = <span class="kw">this</span>;</a>
<a class="sourceLine" id="cb4-22" title="22"><span class="kw">try</span> {</a>
<a class="sourceLine" id="cb4-23" title="23">    <span class="kw">this</span>.<span class="fu">ucallexternConn</span>.<span class="fu">connect</span>(<span class="st">&quot;ucallexternconn&quot;</span>);</a>
<a class="sourceLine" id="cb4-24" title="24">} <span class="kw">catch</span> (error:ArgumentError) {</a>
<a class="sourceLine" id="cb4-25" title="25">    <span class="fu">trace</span>(<span class="st">&quot;连接失败&quot;</span>);</a>
<a class="sourceLine" id="cb4-26" title="26">}</a></code></pre></div>
<p>注意被调用的函数必须是public的。</p>
<p>我使用这个方法并没有成功，最后我采用的是将视频画面直接放在界面上（很丑，不得已为之）。上文的解决方案只是给出一个思路，感兴趣的话可以自己试试。</p>
<h3 id="六last">六、Last</h3>
<p>其实还有很多细节地方可以讲讲，我就不一一展开了。整理的文章就是这样，也没什么花样和娱乐，我都懒得加图片了~</p>
<p>祝大家周末愉快，最近我睡眠很不好，每天6点就醒了，中午补个觉去……</p>

            </div>
            <!-- /.entry-content -->
              
<hr>
<div class="panel">
<div class="panel-body">
   <small>原文链接: <a href="https://blog.alswl.com/2010/08/azaajaxchat-notes-implementation/">https://blog.alswl.com/2010/08/azaajaxchat-notes-implementation/</a></small><br>
   <small>3a1ff193cee606bd1e2ea554a16353ee</small><br>
   <small>欢迎关注我的微信公众号：<a href="http://mp.weixin.qq.com/mp/getmasssendmsg?__biz=MzIyNTIwMTU3MQ==#wechat_webview_type=1&wechat_redirect">窥豹</a></small><br>
   <small><img src="https://4ocf5n.dijingchao.com/upload_dropbox/201605/qrcode_for_gh_17e2f9c2caa4_258.jpg"/></small>
   <small><img src="https://4ocf5n.dijingchao.com/upload_dropbox/meta/wechat-pay-s-crop.png"/></small>
</div>
</div>

    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'log4d'; // required: replace example with your forum shortname

                    var disqus_identifier = 'azaajaxchat-notes-implementation';
                var disqus_url = 'https://blog.alswl.com/2010/08/azaajaxchat-notes-implementation/';

            var disqus_config = function () {
                this.language = "en";
            };

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 col-lg-offset-2" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="https://blog.alswl.com/atom.xml"><i class="fa fa-rss-square fa-lg"></i> RSS</a></li>
                    <li class="list-group-item"><a href="https://twitter.com/alswl"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                    <li class="list-group-item"><a href="https://github.com/alswl"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
                    <li class="list-group-item"><a href="http://weibo.com/alswlx"><i class="fa fa-weibo fa-lg"></i> Weibo</a></li>
                  </ul>
                </li>




        </ul>
    </section>

</aside>        </div>
    <div class="col-lg-3" id="sidebar">
<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><a href="https://blog.alswl.com/"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                    <ul class="list-group" id="categories">
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/coding/">
                                <i class="fa fa-folder-open fa-lg"></i> Coding
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/efficiency/">
                                <i class="fa fa-folder-open fa-lg"></i> Efficiency
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/fun/">
                                <i class="fa fa-folder-open fa-lg"></i> Fun
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/internet/">
                                <i class="fa fa-folder-open fa-lg"></i> Internet
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/life/">
                                <i class="fa fa-folder-open fa-lg"></i> Life
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/managment/">
                                <i class="fa fa-folder-open fa-lg"></i> Managment
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/sre/">
                                <i class="fa fa-folder-open fa-lg"></i> SRE
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/thinking/">
                                <i class="fa fa-folder-open fa-lg"></i> Thinking
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/ui/">
                                <i class="fa fa-folder-open fa-lg"></i> UI
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="https://blog.alswl.com/category/viewpoint/">
                                <i class="fa fa-folder-open fa-lg"></i> Viewpoint
                            </a>
                        </li>
                    </ul>
                </li>


        </ul>
    </section>

</aside>    </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2005-2022 alswl
            &middot; Powered by <a href="https://github.com/alswl/pelican-bootstrap3" target="_blank" style="font-weight: bold">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank" style="font-weight: bold">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank" style="font-weight: bold">Bootstrap</a>,
            <p>
              <small> <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" rel="license"><img alt="Creative Commons License" style="border-width:0" src="https://4ocf5n.dijingchao.com/upload_dropbox/meta/by-nc-nd_4-0_80x15.png"></a> Content licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" rel="license">Creative Commons Attribution 4.0 International-NonCommercial-NoDerivatives License</a>, except where indicated otherwise. </small>
            </p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'log4d'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-8822123-3']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
</body>
</html>