<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Asp.net on Log4D</title>
    <link>https://blog.alswl.com/tags/asp.net/</link>
    <description>Recent content in Asp.net on Log4D</description>
    <generator>Hugo -- 0.135.0</generator>
    <language>zh</language>
    <lastBuildDate>Thu, 05 Nov 2009 00:00:00 +0800</lastBuildDate>
    <atom:link href="https://blog.alswl.com/tags/asp.net/rss.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>MemberShip使用心得</title>
      <link>https://blog.alswl.com/2009/11/membership-the-use-of-experience/</link>
      <pubDate>Thu, 05 Nov 2009 00:00:00 +0800</pubDate>
      <guid>https://blog.alswl.com/2009/11/membership-the-use-of-experience/</guid>
      <description>&lt;p&gt;花了很大一段时间在学习MemberShip，总是要留下一些纪念文章的。
我之前的日志提到过一个简单的用户权限设计：User+Role+UserInRole([http://log4d.com/2009/06/design-of-user-rights](&lt;a href=&#34;http://log4d.com/2009/06/design-of-user-&#34;&gt;http://log4d.com/2009/06/design-of-user-&lt;/a&gt;
rights))，但是这样还是不够灵活，最好需要能够对每一个功能模块进行权限控制，而且需要符合开闭原则。 MemberShip呢，是微软推出的一套很强大的用
户权限管理系统。就我使用的两大部分，主要包括MemberShip和roleManager这两个模块，分别是对用户和角色进行管理。&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>花了很大一段时间在学习MemberShip，总是要留下一些纪念文章的。
我之前的日志提到过一个简单的用户权限设计：User+Role+UserInRole([http://log4d.com/2009/06/design-of-user-rights](<a href="http://log4d.com/2009/06/design-of-user-">http://log4d.com/2009/06/design-of-user-</a>
rights))，但是这样还是不够灵活，最好需要能够对每一个功能模块进行权限控制，而且需要符合开闭原则。 MemberShip呢，是微软推出的一套很强大的用
户权限管理系统。就我使用的两大部分，主要包括MemberShip和roleManager这两个模块，分别是对用户和角色进行管理。</p>
<h2 id="membership对系统进行管理大致分为两个办法">MemberShip对系统进行管理大致分为两个办法</h2>
<p>1.可以通过&quot;登录&quot;系列用户控件的任务窗口中的&quot;管理网站&quot;打开&quot;ASP.Net Web 应用程序管理&quot;。 可以控制用户、角色、权限三个主要属性，另外还能选择
&ldquo;提供程序&rdquo;（这个provider分为MemberShip和RoleManager两种，如果同名的话，可以选择同一提供程序）





<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/upload_dropbox/200911/userControl.jpg" alt="userControl"  />








<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/upload_dropbox/200911/userManager.jpg" alt="userManager"  />



2.使用Web.config进行配置
其实上面的可视化界面在配置提供程序和访问规则（权限设定）时候，本质上修改的是根目录web.config和各个文件夹下对应的web.config</p>
<p>我的根Web.config</p>
<pre><code>&lt;authentication mode=&quot;Forms&quot;&gt;
	&lt;forms name=&quot;ThisHouse&quot; defaultUrl=&quot;Default.aspx&quot; loginUrl=&quot;Signin.aspx&quot; protection=&quot;All&quot; timeout=&quot;30&quot;/&gt;
&lt;/authentication&gt;
&lt;membership defaultProvider=&quot;SqlProvider&quot;&gt;
	&lt;providers&gt;
		&lt;add connectionStringName=&quot;thisHouseConnectionString&quot; enablePasswordRetrieval=&quot;false&quot; enablePasswordReset=&quot;true&quot; requiresQuestionAndAnswer=&quot;true&quot; applicationName=&quot;ThisHouse&quot; requiresUniqueEmail=&quot;false&quot; passwordFormat=&quot;Clear&quot; maxInvalidPasswordAttempts=&quot;255&quot; minRequiredPasswordLength=&quot;1&quot; minRequiredNonalphanumericCharacters=&quot;1&quot; passwordAttemptWindow=&quot;10&quot; passwordStrengthRegularExpression=&quot;&quot; name=&quot;SqlProvider&quot; type=&quot;System.Web.Security.SqlMembershipProvider&quot;/&gt;
	&lt;/providers&gt;
&lt;/membership&gt;
&lt;roleManager enabled=&quot;true&quot; cacheRolesInCookie=&quot;true&quot; defaultProvider=&quot;SqlProvider&quot;&gt;
		&lt;providers&gt;
			&lt;add connectionStringName=&quot;thisHouseConnectionString&quot; applicationName=&quot;ThisHouse&quot; name=&quot;SqlProvider&quot; type=&quot;System.Web.Security.SqlRoleProvider&quot;/&gt;
		&lt;/providers&gt;
&lt;/roleManager&gt;
</code></pre>
<p>我禁止User角色进入Admin文件夹，配置完&quot;访问规则&quot;后，会在Admin文件夹下生成相应web.config</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;configuration&gt;
    &lt;system.web&gt;
        &lt;authorization&gt;
            &lt;allow roles=&quot;User&quot; /&gt;
            &lt;allow roles=&quot;Admin&quot; /&gt;
            &lt;deny users=&quot;?&quot; /&gt;
        &lt;/authorization&gt;
    &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre>
<p>这种单纯的安全机制是以文件为单位进行配置的，不能说完美，但是有效且简单，不失为一种不错的权限控制方法。毕竟这样可以脱离在代码中的配置，而只要关注配置文件。缺
点同样明显，如果想在同一个动作aspx文件中进行权限判断，就难以有效的实现，需要修改aspx代码了。</p>
<h2 id="membership在net-35中方法的集成">MemberShip在.NET 3.5中方法的集成</h2>
<p>这个标题有点大，实际上在我的课程设计中，用到了判断是否登录、判断用户角色这两个简单的方法。</p>
<pre><code>if (Page.User.Identity.IsAuthenticated)
{
	this.Login1.Visible = false;
	this.LoginStatus1.Visible = true;
	this.pEditProfile.Visible = true;
}
foreach (string role in Roles.GetRolesForUser())
{
	if (role == &quot;Admin&quot;)
	{
		this.pAdmin.Visible = true;
	}
}
</code></pre>
<p>这段代码第一个if进行了是否登录的判断，然后foreach循环判断用户角色。 大部分方法在&quot;System.Web.Security.Roles&quot;、&ldquo;Syst
em.Web.Security.Membership&quot;中，可以在MSDN查到相关内容。</p>
<h2 id="后话">后话</h2>
<p>MemberShip是一个很强大的框架，无论是使用还是学习，都是不错的对象。我这里只是一个星期使用的一点小心得，不是一个HowTo。 .NET既然提供了这么
好的东西，希望大家可以用起来，而不要简单的使用User+代码中判断User的某个权限字段，要把耦合的思想和设计模式的思想在实际中进行一些尝试。（好吧，我设计
模式其实基本不懂```会吹吹罢了）</p>
]]></content:encoded>
    </item>
    <item>
      <title>ThisHouse房屋销售系统</title>
      <link>https://blog.alswl.com/2009/11/thishouse-housing-sales-system/</link>
      <pubDate>Thu, 05 Nov 2009 00:00:00 +0800</pubDate>
      <guid>https://blog.alswl.com/2009/11/thishouse-housing-sales-system/</guid>
      <description>&lt;p&gt;呃，这是我在一个星期内搞鼓的一个Asp.NET课程设计，没有什么太多的内容，把它发布到了Csdn了，开了5分，嗯，对得起我一个星期拼命码代码。（哦，我很无耻
的使用了&lt;a href=&#34;http://www.neoease.com/&#34;&gt;MG12&lt;/a&gt;的iNove主题……）&lt;/p&gt;
&lt;p&gt;




&lt;img loading=&#34;lazy&#34; src=&#34;https://blog.alswl.com/images/upload_dropbox/200911/thisHouse.jpg&#34; alt=&#34;thisHouse&#34;  /&gt;


&lt;/p&gt;
&lt;h2 id=&#34;readmetxt内容&#34;&gt;readme.txt内容：&lt;/h2&gt;
&lt;p&gt;This House房屋销售系统 本人大四一个课程设计，大概花费1周时间，构架2天，编码3天，零碎程序1天，论文1天。&lt;/p&gt;
&lt;p&gt;程序写的不好不坏，是DAL+BLL+Model+Web三层架构，使用的动软生成器生成的简单三层框架。压缩包包括源码，数据库，一个star
uml简单设计图，数据库文档，需求分析和论文。&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>呃，这是我在一个星期内搞鼓的一个Asp.NET课程设计，没有什么太多的内容，把它发布到了Csdn了，开了5分，嗯，对得起我一个星期拼命码代码。（哦，我很无耻
的使用了<a href="http://www.neoease.com/">MG12</a>的iNove主题……）</p>
<p>




<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/upload_dropbox/200911/thisHouse.jpg" alt="thisHouse"  />


</p>
<h2 id="readmetxt内容">readme.txt内容：</h2>
<p>This House房屋销售系统 本人大四一个课程设计，大概花费1周时间，构架2天，编码3天，零碎程序1天，论文1天。</p>
<p>程序写的不好不坏，是DAL+BLL+Model+Web三层架构，使用的动软生成器生成的简单三层框架。压缩包包括源码，数据库，一个star
uml简单设计图，数据库文档，需求分析和论文。</p>
<p>系统关键词是： <strong>Asp.NET</strong>; <strong>MemberShip</strong>;
<strong>iBatisNet</strong>; <strong>AjaxControlToolkit</strong>; **房屋销售系统 **
数据库使用的是一个完整的MemberShip 权限管理系统，而不是我自己写的简单User in Role，所以建议对这个MemberShip有一定了解。</p>
<p>整个系统关注的是框架的使用，对于业务逻辑关注很少，实在是我时间有限，没有更多的精力搞.NET。（我学Asp.Net 3个月了，之前是搞Java的）
如果有问题可以到http://log4d.com留言，本人大四，会在有时间前提下回答，毕竟现在我正在找工作。</p>
<h2 id="我写代码时候总结的一些资料">我写代码时候总结的一些资料</h2>
<p>[AjaxControlToolKit控件介绍[转载]](<a href="http://log4d.com/2009/10/ajaxcontroltoolkit-">http://log4d.com/2009/10/ajaxcontroltoolkit-</a>
controls-introduced-reproduced)
[MemberShip在动软生成器下UserId的问题](<a href="http://log4d.com/2009/10/membership-moving-soft-">http://log4d.com/2009/10/membership-moving-soft-</a>
issue-of-builder-under-the-userid)</p>
<h2 id="源码下载">源码下载</h2>
<p><a href="http://download.csdn.net/source/1794504">点击这里到CSDN下载</a>[5分]</p>
]]></content:encoded>
    </item>
    <item>
      <title>由No photo引起</title>
      <link>https://blog.alswl.com/2009/08/no-photo-caused-by-the/</link>
      <pubDate>Tue, 25 Aug 2009 00:00:00 +0800</pubDate>
      <guid>https://blog.alswl.com/2009/08/no-photo-caused-by-the/</guid>
      <description>&lt;p&gt;




&lt;img loading=&#34;lazy&#34; src=&#34;https://blog.alswl.com/images/upload_dropbox/201612/404.png&#34; alt=&#34;image&#34;  /&gt;


&lt;/p&gt;
&lt;p&gt;某个系统，检查用户照片，如果发现用户并没有设定照片就返回一张No Photo的图片。&lt;/p&gt;
&lt;p&gt;返回数据库的图片代码比较格式化。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;int Id = Int32.Parse(Request.Params.Get(&amp;quot;Id&amp;quot;));
string type = Request.Params.Get(&amp;quot;type&amp;quot;);
BLL.Student bll = new JznuManager.BLL.Student();
student = new JznuManager.Model.Student();
student = bll.GetModel(Id);
Response.ContentType = &amp;quot;image/jpeg&amp;quot;;
Response.Cache.SetCacheability(HttpCacheability.Public);
Response.BufferOutput = false;
//输出图片文件二进制数据
Response.OutputStream.Write(student.entryPhoto, 0, (int)student.entryPhoto.Length);
Response.End();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而如果返回的图片为空时候，就需要填充原先的图片Img。&lt;/p&gt;
&lt;p&gt;1.我起初设置了Img的默认背景background，当没有图片出来时候，就可以显示出原先背景，但很快发现这个办法的弊病，如果数据库图片过小则会导致背景图片
露出来。&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>




<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/upload_dropbox/201612/404.png" alt="image"  />


</p>
<p>某个系统，检查用户照片，如果发现用户并没有设定照片就返回一张No Photo的图片。</p>
<p>返回数据库的图片代码比较格式化。</p>
<pre><code>int Id = Int32.Parse(Request.Params.Get(&quot;Id&quot;));
string type = Request.Params.Get(&quot;type&quot;);
BLL.Student bll = new JznuManager.BLL.Student();
student = new JznuManager.Model.Student();
student = bll.GetModel(Id);
Response.ContentType = &quot;image/jpeg&quot;;
Response.Cache.SetCacheability(HttpCacheability.Public);
Response.BufferOutput = false;
//输出图片文件二进制数据
Response.OutputStream.Write(student.entryPhoto, 0, (int)student.entryPhoto.Length);
Response.End();
</code></pre>
<p>而如果返回的图片为空时候，就需要填充原先的图片Img。</p>
<p>1.我起初设置了Img的默认背景background，当没有图片出来时候，就可以显示出原先背景，但很快发现这个办法的弊病，如果数据库图片过小则会导致背景图片
露出来。</p>
<p>2.我考虑在GetPhoto.aspx这个方法内写入判断，在catch中读取一个本地图片文件，再转化为BitMap，再设置content-
type，用Response.OutputStream输出</p>
<p>3.上面这个方法调试了很久，老是参数错误，最后我突然想起来一个方法。</p>
<pre tabindex="0"><code>Response.Redirect(&#34;./Images/nophot.gif&#34;);
</code></pre><p>这几句话就能解决上述所有问题。</p>
<p>呃，有时候花费了好久，饶了很多弯的问题，其实好好想想反而会很简单。</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
