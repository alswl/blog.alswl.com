<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Hugo on Log4D</title>
    <link>https://blog.alswl.com/tags/hugo/</link>
    <description>Recent content in Hugo on Log4D</description>
    <generator>Hugo -- 0.128.2</generator>
    <language>zh</language>
    <lastBuildDate>Sat, 25 Nov 2023 17:23:35 +0800</lastBuildDate>
    <atom:link href="https://blog.alswl.com/tags/hugo/rss.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>如何免费用云服务搭建博客评论系统</title>
      <link>https://blog.alswl.com/2023/11/build-blog-comment-system-based-on-free-cloud-service/</link>
      <pubDate>Sat, 25 Nov 2023 17:23:35 +0800</pubDate>
      <guid>https://blog.alswl.com/2023/11/build-blog-comment-system-based-on-free-cloud-service/</guid>
      <description>问题 博客自 2012 年从 WordPress 迁移到静态站点后，就选择了 Disqus 作为评论系统。 但最近 Disqus 硬广告过于频繁，迫切寻找新的评论系统。 Disqus 官方 明确说明，要去掉广告就付费。 What if I want to remove Ads? If you&amp;rsquo;d like to remove Disqus Ads from your integration, you may purchase and ads-free subscription from your Subscription and Billing page. More information on Disqus ads-free subscriptions may be found here. OK，那再见吧 Disqus，我会找到可靠、免费、易用的评论系统。 最后既然是寻找新的评论系统，现在 2023 年了， 我希望这个新系统充分使用云服务的便利，要做到 免费、可靠、易运维。 选型原则 在进入</description>
      <content:encoded><![CDATA[<h2 id="问题">问题</h2>
<p>博客自 2012 年从 WordPress 迁移到静态站点后，就选择了 Disqus 作为评论系统。
但最近 Disqus 硬广告过于频繁，迫切<mark>寻找新的评论系统</mark>。</p>
<p><a href="https://help.disqus.com/en/articles/1717119-ads-faq">Disqus 官方</a> 明确说明，要去掉广告就付费。</p>
<blockquote>
<p>What if I want to remove Ads?
If you&rsquo;d like to remove Disqus Ads from your integration, you may purchase and ads-free subscription from your Subscription and Billing page. More information on Disqus ads-free subscriptions may be found here.</p>
</blockquote>
<p>OK，那再见吧 Disqus，我会找到可靠、免费、易用的评论系统。
最后既然是寻找新的评论系统，现在 2023 年了，
我希望这个新系统<mark>充分使用云服务的便利</mark>，要做到
<mark>免费、可靠、易运维</mark>。</p>
<p>




<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/202311/no-disqus-twitter.png" alt="no-disqus-twitter"  />


</p>
<h2 id="选型原则">选型原则</h2>
<p>在进入探索之前，我先梳理一下自己的原则和选型要求：</p>
<ul>
<li>数据自有是核心要求
<ul>
<li>确保评论数据完全归属于博主，不会因为使用第三方服务而失去对数据的控制。</li>
</ul>
</li>
<li>服务部署和存储是难点
<ul>
<li>考虑到服务的稳定性和成本，选择一个易于部署且存储成本较低的方案。</li>
</ul>
</li>
<li>访问速度是考虑项
<ul>
<li>评论系统的访问速度直接关系到用户体验，
因此需要选择一个能够提供较快访问速度的系统。</li>
</ul>
</li>
</ul>
<p>从功能上面分析需要的能力：</p>
<ul>
<li>邮件通知</li>
<li>Markdown</li>
<li>内容安全：No Injection</li>
<li>评论审核和删除</li>
<li>授权登录（Optional）</li>
</ul>
<p>非功能需求：</p>
<ul>
<li>低成本：控制在 12 元 / 年</li>
<li>系统稳定</li>
</ul>
<p>通过明晰这些原则和要求，可以更有针对性地选择合适的评论系统，确保满足核心功能和非功能需求。接下来，将根据这些原则，继续探讨如何选择和搭建评论系统。</p>
<h2 id="初步方案探索">初步方案探索</h2>
<p>现在我们初步试验一些方案并进行一些探索，以方便我们熟悉一下当前常见系统的<mark>特性和水准</mark>。</p>
<h3 id="utteranceshttpsutterances"><a href="https://utteranc.es/">utterances</a></h3>
<p>




<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/202311/utterances.png" alt="utterances"  />


</p>
<ul>
<li>经常见到的一个评论系统，流行于程序员群体，基于 Github Issues 系统因此免费，需要使用 Github 账号登录</li>
<li>7.8k star</li>
<li>托管在 Github Issues</li>
</ul>
<h3 id="twikoohttpstwikoojsorgquick-starthtml"><a href="https://twikoo.js.org/quick-start.html">Twikoo</a></h3>
<p>




<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/202311/twikoo.png" alt="twikoo"  />


</p>
<ul>
<li>国产方案，基于云服务展开，需要寻找云函数部署环境（大部分收费）</li>
<li>880 star</li>
</ul>
<h3 id="cusdishttpscusdiscom"><a href="https://cusdis.com/">Cusdis</a></h3>
<p>




<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/202311/cusdis.png" alt="cusdis"  />


</p>
<ul>
<li>国产方案，提供免费的 Cloud 服务（但是额度比较受限）</li>
<li>2.4k star</li>
<li>支持迁移</li>
<li>手工通过评论</li>
<li>活跃度不高</li>
</ul>
<p>我同时还看了一些外部的一些方案评测报告：</p>
<ul>
<li><a href="https://gohugo.io/content-management/comments/">Comments | Hugo</a></li>
<li><a href="https://cloud.tencent.com/developer/article/2196035?areaSource=&amp;traceId=">静态博客评论系统的选择 - 腾讯云开发者社区-腾讯云</a></li>
<li><a href="https://sspai.com/post/73412">轻量级开源免费博客评论系统解决方案 （Cusdis + Railway） - 少数派</a></li>
</ul>
<p>根据初步方案探索，我可以明确部署形态基本如下：</p>
<p>




<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/202311/comment-system-deploy-diagram.png" alt="comment-system-deploy-diagram"  />


</p>
<h2 id="横向对比">横向对比</h2>
<p>这是一个横向对比表格，列举我一些关心的特性以及候选者在这些特性方面的表现。除了上述提到几款常见软件，
我还额外调研了<mark>海外常用的评论 SaaS 服务</mark>：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>self-host</th>
<th>Official SaaS</th>
<th>SaaS Free</th>
<th>Star</th>
<th>Import Disqus</th>
<th>export data</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>Utterances</td>
<td>x</td>
<td>v</td>
<td>v</td>
<td>7.8k</td>
<td></td>
<td>v</td>
<td>Github account required</td>
</tr>
<tr>
<td>Cusdis</td>
<td>v</td>
<td>v</td>
<td>v?</td>
<td>2.3k</td>
<td>v</td>
<td>v?</td>
<td>import from Disqus failed</td>
</tr>
<tr>
<td>Cactus Comments</td>
<td>v</td>
<td>v</td>
<td></td>
<td>100</td>
<td></td>
<td></td>
<td>Matrix Protocol, blocked</td>
</tr>
<tr>
<td>Commento</td>
<td>x</td>
<td>v</td>
<td>$10/month</td>
<td></td>
<td>v</td>
<td>v</td>
<td></td>
</tr>
<tr>
<td>Graph Comment</td>
<td></td>
<td>v</td>
<td>Free to $7</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Hyvor Talk</td>
<td>x</td>
<td>v</td>
<td>$12/month</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>IntenseDebate</td>
<td></td>
<td>v</td>
<td>?</td>
<td></td>
<td>x</td>
<td></td>
<td>too old</td>
</tr>
<tr>
<td>Isso</td>
<td>v</td>
<td>x</td>
<td></td>
<td>4.8k</td>
<td>v</td>
<td></td>
<td>sqlite storage</td>
</tr>
<tr>
<td>Mutt</td>
<td></td>
<td>v</td>
<td>$16/month</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Remark42</td>
<td>v</td>
<td>x</td>
<td></td>
<td>4.3k</td>
<td>v</td>
<td>v</td>
<td>full featured, one file storage</td>
</tr>
<tr>
<td>ReplyBox</td>
<td></td>
<td>v</td>
<td>$5/month</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Staticman</td>
<td>v</td>
<td></td>
<td></td>
<td>2.3k</td>
<td></td>
<td>v</td>
<td>using github as storage</td>
</tr>
<tr>
<td>Talkyard</td>
<td></td>
<td>v</td>
<td>€4.5/ month</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Waline</td>
<td>v</td>
<td></td>
<td></td>
<td>1.5k</td>
<td>v</td>
<td>v</td>
<td>Multi Storage / Service Provider supported</td>
</tr>
<tr>
<td>Twikoo</td>
<td>v</td>
<td>x</td>
<td></td>
<td>1.1k</td>
<td>v</td>
<td>v</td>
<td>FaaS / MongoDB</td>
</tr>
</tbody>
</table>
<p>根据横向对比我们可以得出几个结论：</p>
<ul>
<li>海外传统评论系统数据透明度低，风格也是是古早型系统</li>
<li>官方提供 SaaS 服务普遍需要收费</li>
<li>self-host 的几个产品需要自己搭建服务，没有一键使用免费的 Cloud Provider 路径</li>
</ul>
<p><strong>小结</strong></p>
<p>符合我需求的几款产品是：Utterances、Cusdis、Waline。</p>
<h2 id="poc-和实施">PoC 和实施</h2>
<p>我最后选择了 utterances 和 Waline 进行 PoC，
其中我的<a href="https://en.blog.alswl.com/">英文博客</a>使用了 utterances，
<a href="https://blog.alswl.com/">中文博客</a>使用了 Waline。</p>
<p>为什么不选择 Cusdis 和 Twikoo？因为 Cusdis 使用 PostgreSQL，
而 Twikoo 存储使用腾讯云函数（免费额度有限）或者 MongoDB，
存储上 Waline 选择更多。
另外，作为同类型方案，Waline 是三者贡献者数量最多的，Commit 数量也最多，
社区更有保障。</p>
<h3 id="waline-实施">Waline 实施</h3>
<blockquote>
<p>一个搞笑的点，如果这里使用 h3 标题叫做「Waline」，会直接在这里插入一个当前博客的评论框</p>
</blockquote>
<ul>
<li>优点
<ul>
<li>多平台部署</li>
<li>多数据库支持（MongoDB、sqlite、PostgreSQL、MySQL）</li>
<li>评论功能强大</li>
<li>导入工具</li>
<li>活跃度尚可</li>
</ul>
</li>
<li>缺点
<ul>
<li>功能太多，不够克制（好在可以自定义配置）</li>
<li>国产产品</li>
</ul>
</li>
<li>接入流程：
<ul>
<li>找个 Storage 供应商（我选择 <mark>LeanCloud</mark>）</li>
<li>找个 Server 供应商部署（我选择 <mark>Vercel</mark>）</li>
<li>找个邮件发送供应商（我选择了 <mark>Brevo</mark>（原来叫 SendinBlue））</li>
<li>前端部署（Hugo 内集成一下）</li>
</ul>
</li>
</ul>
<p>部署图：</p>
<p>




<img loading="lazy" src="https://e25ba8-log4d-c.dijingchao.com/202311/waline.png" alt="waline"  />


</p>
<p>具体操作，跟随官方文档即可：</p>
<ul>
<li><a href="https://waline.js.org/guide/get-started/">快速上手 | Waline</a></li>
<li><a href="https://waline.js.org/guide/deploy/vercel.html#%E5%A6%82%0E4%BD%95%E9%83%A8%E7%BD%B2">Vercel 部署 | Waline</a></li>
<li>绑定 CName</li>
<li>导入数据
<ul>
<li>转换 <a href="https://waline.js.org/migration/tool.html">数据迁移助手 | Waline</a></li>
<li>导入 <a href="https://console.leancloud.app/apps/yours/storage/import-export">https://console.leancloud.app/apps/yours/storage/import-export</a></li>
</ul>
</li>
<li>配置页面
<ul>
<li>参考配置系统禁用一些评论功能 <a href="https://waline.js.org/reference/client/props.html">https://waline.js.org/reference/client/props.html</a></li>
<li>启用 SMTP
<ul>
<li>配置 <code>AUTHOR_EMAIL</code></li>
<li>配置 <code>SENDER_NAME</code></li>
<li>配置 <code>SENDER_EMAIL</code></li>
</ul>
</li>
<li>服务端配置 <a href="https://waline.js.org/reference/server/config.html#tgtemplate">https://waline.js.org/reference/server/config.html#tgtemplate</a></li>
</ul>
</li>
<li>遇到的问题
<ul>
<li>Disqus 导出的用户数据没有邮箱，导致 gravatar 没有照片显示，无解</li>
<li>邮箱配置需要额外配置环境变量，否则会暴露自己的个人邮箱</li>
</ul>
</li>
</ul>
<p>实施 PR（仅包含前端，因为后端代码包含了密钥，不便于分享）：
<a href="https://github.com/alswl/blog.alswl.com/commit/e34e34810298fd0d716d4c4a467fada25b3a6622">feat: comments on waline · alswl/blog.alswl.com@e34e348</a></p>
<h3 id="utterances-实施">Utterances 实施</h3>
<p>utterances 的部署则更为简单，一个 PR 就可以启用。
<a href="https://github.com/alswl/en.blog.alswl.com/commit/29028f677e362570a8bcaf5316847ddfa3e9d685">feat: comment using utteranc · alswl/en.blog.alswl.com@29028f6 (github.com)</a></p>
<p>也没有什么特色，主打简单省事，考虑我英文博客访问量极低，就简单方案。</p>
<h2 id="小结">小结</h2>
<p>最后我选择了 Waline / utterances 作为我的评论系统，两者的部署成本都是 0。</p>
<p>妥协牺牲了一些访问速度、安全性，但进一步增强了数据可控性，完成了 self-host。
从稳定性上面来看，尽管这个系统链路变复杂了，单机上也存在可用性风险，
但依托 Vercel / LeanCloud / Brevo 三家 SaaS 服务商，整体风险可控。</p>
<p>毕竟只是一个小小评论系统，0 成本 + 正常工作就行了。</p>
<p>欢迎在下面评测测试一下哦~</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
