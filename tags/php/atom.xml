<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>php on Log4D</title>
    <link>https://blog.alswl.com/tags/php/</link>
    <description>Recent content in php on Log4D</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Sun, 06 Nov 2011 00:00:00 +0800</lastBuildDate><atom:link href="https://blog.alswl.com/tags/php/atom.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>128M内存VPS LNMP安装优化小记</title>
      <link>https://blog.alswl.com/2011/11/vps-lnmp-setup-config/</link>
      <pubDate>Sun, 06 Nov 2011 00:00:00 +0800</pubDate>
      
      <guid>https://blog.alswl.com/2011/11/vps-lnmp-setup-config/</guid>
      <description>重要通知：Log4D 的域名由 http://dddspace.com 迁移到 http://log4d.com 。 订阅地址现在改为 http://log4d.com/feed 和 http://feeds.feedburner.com/dddspace 。（FeedBurner 的地址未发生变化）
这一次域名迁移的同时，我更换了服务器，由原先的虚拟空间迁移到独立 VPS。 现在使用的 VPS 是 PhotonVPS 。
月付5.95美元，使用优惠码 TENOFF 或 PHOTONLEB 可以打7折， 换算汇率之后是26人民币每月。
这款VPS的内存只有128,我们就要精打细算考虑如何省内存。经过我几天琢磨， 我终于配置的可用率比较高，使用 siege -c 100 -t 100 时候可以保持 100% 可用率。 （其实做不到这么高的并发，大概10个并发每秒）下面就是我记录的安装配置过程。
安装 LNMP Linux 发行版选用 CentOS 据说有较好的安全性和性能，我个人更喜欢 Arch。查询了相关资料， 在生产环境使用 Arch 的似乎不多。
CentOS 里面的包比较旧，不像 Arch 里面，滚动最新。 所以这里需要用到的LNMP大部分都需要自行编译。
Nginx 安装 Nginx 的性能在小内存低配置的服务器上跑得比 Apache 要好。这是我们为什么选用 Nginx。
目前 Nginx 的最新稳定版是1.0.9版。CentOS 官方源里面搜索不到 Nginx，需要自行编译。
准备编译环境，需要安装一堆工具，使用下面这个命令 yum 安装。
yum -y install gcc gcc-c++ autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers 下载Nginx</description>
    </item>
    
    <item>
      <title>AzaAjaxChat笔记-实现</title>
      <link>https://blog.alswl.com/2010/08/azaajaxchat-notes-implementation/</link>
      <pubDate>Sun, 22 Aug 2010 00:00:00 +0800</pubDate>
      
      <guid>https://blog.alswl.com/2010/08/azaajaxchat-notes-implementation/</guid>
      <description>唔，继续整理笔记，这些是在代码编写中遇到的问题和解决办法的总结，不是Turtial，问题有针对性，内容枯燥，路人可以直接忽略~
一、Comet服务器推技术 Comet推技术，一句话概括，就是形成一个不断开的连接，使得服务器能主动向客户端发送信息。这种技术在交互性强的Web产品中应用的非常多，比如GMail。Co met的实现方式有两种：基于 AJAX 的长轮询（long-polling）方式和基于 Iframe 及 htmlfile 的流（streaming）方式，具体两种实现方式可以参考Comet：基于 HTTP 长连接的&amp;quot;服务器推&amp;quot;技术。
我计划把这个技术引入，成为一个亮点，第二种Comet实现方式过于复杂（GMail使用的就是这种），我就尝试第一种。我在测试环境测试了基于 AJAX 的长轮询 （long-polling）方式。这种方式说白了就是在Ajax获取返回数据时候，在状态吗为4（数据传输完成）情况随后进行下次查询。进行循环的查询。
这种Long-polling的轮询方式有点伪Comet。相对于常见的定时查询，不同点是将&amp;quot;查询-&amp;gt;返回-&amp;gt;再查询&amp;quot;中间的一段断开时间进行重连接。最后因为技术 实现和开发时间，我决定放弃了Comet的实现。
PS：一个系统应该不仅仅是技术的堆积，也应该考虑其他的一些因素，是否有确实需求，开发效率问题。虽然我做了一些前期准备，最终还是没有加入Comet，蛮可惜的。
相关链接： 一步一步打造WebIM（1） - .net - dotnet - JavaEye论坛 （.net使用IHttpAsyncHandler的实现） Comet&amp;ndash;&amp;ldquo;服务器推&amp;quot;技术 - 搜狐UED（搜狐UED团队的一个小介绍） 二、用户状态的处理 开发时候遇到一个逻辑问题，具体描述如下：&amp;ldquo;一个用户登录长时间不活动（比如直接关闭浏览器），系统需要判定此用户为离线。&amp;ldquo;按照一般设计思路，这个动作应该由后台每 过一段时间自动（比如说5分钟）触发一次，如果用Java或.net实现，会考虑设计一个后台运行的进程进行管理。而现在用的PHP，我查了一下，似乎没有找到相应的 解决办法。
我尝试在系统中设定一个页面每隔几分钟触发一个动作，放置在index.php页面中，但是感觉这个设计有点鸡肋。
这个问题困惑我很久，最后参考了AJAX Chat的源码，它的思路是在一个新用户上线时候，进行检测所 有用户距离上次其活动的时间来判定每个用户的离线状态。这个也不是最优想法（万一长时间没有用户登录怎么办？），但是比上面那个定时页面要好多了。
如果有PHP达人看到这个，望不惜赐教。
三、RTMP RTPM是一个流媒体传输的协议，我在AzaAjaxChat中用它进行视频聊天画面和音频传输。这块内容可以洋洋洒洒的写一大篇日志，我在这里只是简单罗列一下我用 到的相关内容。
Real Time Messaging Protocol（实时消息传送协议协议)概述，实时消息传送协议是Adobe Systems公司为Flash播放器和服务器之间音频、视频和数据传输开发的私有协议。它有三种变种： 1)工作在TCP之上的明文协议，使用端口1935； 2)RTMPT封装在HTTP请求之中，可穿越防火墙； 3)RTMPS类似RTMPT，但使用的是HTTPS连接；
RTMP协议是被Flash用于对象，视频,音频的传输.该协议建立在TCP协议或者轮询 HTTP协议之上。
RTMP协议就像一个用来装数据包的容器，这些数据可以是AMF格式的数据，也可以是FLV中的视/音频数据。一个单一的连接可以通过不同的通道传输多路网络流。 这些通道中的包都是按照固定大小的包传输的。
我使用FMS作为RTPM容器，Adobe FMS（Flash Media Server）是一款能够提供出色的Flash Video流媒体播放功能的服务器软件。
FMS提供一个强大Script可定制脚本的服务器流媒体引擎，通过这个引擎，允许创建和交付面向互联网任何用户群体的交互媒体应用及服务。FMS还是Adobe公司 跨媒体解决方案中的一部分，针对诸如数据库连接访问、文件系统操作、服务访问等要求，可以同Adobe Flash Player与Adobe AIR一起来实现。
四、基于Flex的流媒体传输 4.1 官方Sample-Stratus AzaAjaxChat中最技术含量的地方在于语音视频聊天。Adobe官网在Flex子类中提供了一个Demo名叫[Stratus](http://labs.a dobe.com/technologies/stratus/samples/)，正是一个聊天系统。从教程上看，Adobe公司目前开放的Stratus是同时支 持视频和语音P2P的，同时，未来的FMS也可能会支持P2P。</description>
    </item>
    
    <item>
      <title>AzaAjaxChat笔记-框架</title>
      <link>https://blog.alswl.com/2010/08/azaajaxchat-notes-frame/</link>
      <pubDate>Thu, 12 Aug 2010 00:00:00 +0800</pubDate>
      
      <guid>https://blog.alswl.com/2010/08/azaajaxchat-notes-frame/</guid>
      <description>1个月没有动PHP了，新装的系统甚至还没有配置PHP环境，今天看到BooguNote上有一个boo是专门记录AzaAjaxChat开发时候遇到的问题和解决办 法。于是把一些东西整理记录一下。
1. 从ThinkPHP开始 最早的AzaAjaxChat是基于ThinkPHP的，我当时在OpenSouce上看到ThinkPHP的介绍，有很多优点，看的我很心动：MVC模型，Ajax 支持，详细的文档和案例，国人开发的框架。我作为一个PHP新人一下子就被他吸引住了，决定用ThinkPHP做框架。
随着系统开发的推进，我却感觉到一些不自在，遇到一些问题却找不好太好的解决办法。比如ThinkPHP的模块和分组两个概念，让我比较疑惑，花费了大量时间重组目录 结构，两种方法各有优劣，让我很难选择（有选择了反而难办了 ^_^）。
最让我恼火的是相对目录带来的路径混乱，在JSP开发中，静态内容习惯性放在webcontent文件夹中，而ThinkPHP的CSS、图片、JS引用让我很疑惑， 要区分App的和Model的静态文件。
在开发过程中，我也遇到过框架本身的Bug，让我对这个框架失去信心。在这里我没有贬低ThinkPHP或者ThinkPHP开发者的意思，他们的&amp;quot;大道至简、开发由 我&amp;quot;的理念很值得欣赏。只是作为初学者因为遇到的一些问题，带来了一定的开发难度，不得已放弃。
2. 选择CakePHP 在遇到数次挫折之后，我终于下定决心换框架。工作室之前有过一个项目是用CakePHP开发的，保存着一些资料，阿贵强烈推荐CakePHP。我Google了几篇框 架的评测文章后，考虑了一下AzaAjaxChat的规模，决定选择CakePHP。
CakePHP的脚手架(Scaffold)功能让我眼前一亮，让我脱离了大量CRUD繁琐的操作。而Cake Bake可以方便的根据数据库生成php代码，减少那 些没有逻辑意义的代码。AzaAjaxChat的定位是毕业设计，不是强健的产品，不会苛求太高的用户体验和安全特性，所以这个功能帮了我很多忙。
CakePHP能够处理关系型数据库之间的m-n关系，由于我的系统逻辑简单，并没复杂的多表操作，所以这里没有深究。从Cake Baker的生成代码菜单上应该能够看出CakePHP还是能够处理一定的多表关联问题。
CakePHP也不是那么十全十美，最麻烦的是文档少，我指的是中文文档，英文资源还是比较丰富的。其次是对Ajax的支持不如ThinkPHP那么原生，我一开始使 用JSON方案，后来使用XML方案实现Ajax数据序列化。
3. CakePHP &amp;amp; ThinkPHP 使用的框架最大的目的是提高效率，大幅度缩短工作时间，这两个框架都是为此而诞生的。我这里不说孰优孰劣，如果感兴趣，可以Google查看相关比较。这两个框架都使 用Ruby On Rails的Active Record理念进行开发，CakePHP更是被称为PHP版的RuR，我在编码中期还特意去图书馆查阅了RuR的相关资料，的确是高效的Web开发模型。
Active Record释义
ActiveRecord也属于ORM层，由Rails最早提出，遵循标准的ORM模型：表映射到记录，记录映射到对象，字段映射到对象属性。配合遵循的命名和配 置惯例，能够很大程度的快速实现模型的操作，而且简洁易懂。
我在答辩的PPT中写选择CakePHP的原因有三：一站式的MVC框架、约定优于配置、更少的代码，其实这也是RuR的优势。
4. 相关连接 Plod: [翻译]十款PHP开发框架横向比较 ChinaUnix一位网友写的CakePHP入门（我觉得比官方教材好上手） cakephp jquery ajax json_天知道_百度空间（CakePHP的Ajax操作方法） 老王的技术手册_博客_cakephp / zendframework_百度空间（挺多CakePHP相关资料） IBM developerWorks 中国 : 使用 CakePHP 快速打造 Web 站点（IBM的CakePHP教程） </description>
    </item>
    
    <item>
      <title>Cakephp的国际化和poEdit的使用</title>
      <link>https://blog.alswl.com/2010/06/cakephp-localization-internationalization-and-usage-of-poedit/</link>
      <pubDate>Thu, 03 Jun 2010 00:00:00 +0800</pubDate>
      
      <guid>https://blog.alswl.com/2010/06/cakephp-localization-internationalization-and-usage-of-poedit/</guid>
      <description>原文出处：在Cakephp中使用i18n本地化程序，并使用poedit编辑语言文件 | 程序如此灵动！
alswl: 官方的帮助手册都没有这篇文章来的详细，太赞了。这篇文章不仅介绍了CakePHP的使用，更多的介绍了PoEdit的使用，图文并茂，着实详细，感谢原作者苏南。
&amp;mdash;&amp;ndash; 以下为原文 &amp;mdash;&amp;ndash;
Cakephp的很强大的i18n功能就是用来实现本地化和国际化的。他通过使用语言配置文件使得程序能够很好的适应变化进行本地化。通过新建locale/chi/ LC_MESSAGES/default.po文件，并指定语言选项为&amp;quot;chi&amp;quot;实现。本文中说的就是如何实现这个本地化过程，当然本文中的poedit并不是必须的 ，但是他可以使得工作效率更高。
一、关于i18n和L10n 这2个东东其实头一次我看到的时候也是一头雾水，但是经过百度的一通搜索，得出的结论就是，不管是几个n，最终的目的就是实现程序本地化就好了，说白了，就是由很多的 语言配置文件，反正我是这么理解的。大家也可以去看看，[http://baike.baidu.com/view/372835.htm](http://baik e.baidu.com/view/372835.htm) 这里有很详细的说明。
二、在Cakephp里面，实现本地化的方法 目前为止，有2种配置方法。
2.1 方法一 在config/core.php中使用configure::write来制定语言文件。
Configure::write(&amp;lsquo;Config.language&amp;rsquo;,&amp;ldquo;chi&amp;rdquo;);
2.2 方法二 官方说明：http://book.cakephp.org/view/162/Localizing-Your- Application
貌似很复杂的说哦。
App::import(&#39;Core&#39;, &#39;l10n&#39;); class TestsController extends AppController{ $name=&amp;quot;Tests&amp;quot;; function test_function(){ $this-&amp;gt;L10n-&amp;gt;new L10n(); $this-&amp;gt;L10n-&amp;gt;get(&amp;quot;chi&amp;quot;); ..... } } 2.3 做上边设置改动后需要做的： 当然在上面做修改后，还需要修改对应的ctp文件等哦，
所有的直接输出字符串，没有返回值的地方像这样：
__(``&amp;quot;english&amp;quot;``);
间接输出字符串，有返回的地方：
__(``&amp;quot;english&amp;quot;``,``true``);
还有input要加个label来使他出现中文。
(&amp;ldquo;english&amp;rdquo;);echo $form-&amp;gt;input(&amp;rsquo;name&amp;rsquo;,array(&amp;rsquo;label&amp;rsquo;=&amp;gt;(&amp;rsquo;name&amp;rsquo;,true)));
2.4 最最重要的一步 就是要编辑这个文件了，locale/chi/LC_MESSAGES/default.po。中间的chi就是语言文件的标志位了。这个文件的格式也很简单，
msgid &amp;ldquo;Chinese&amp;rdquo;
msgstr &amp;ldquo;中国话&amp;rdquo;
这个的简单重复就行了。
三、使用poedit 使用poedit不是必须的，但是可以使工作变得简单的多。官方网站是：[http://www.poedit.net/](http://www.poedit.n et/)
他的主要功用就是使得编辑语言配置文件更加方便和快捷。下面是使用poedit的一些简单的截图和说明。
3.1 头一次使用需要选择界面语言 3.2 新建一个配置文件，就是我们的目的文件po文件了 工程信息这里当然要选择好utf8格式了
路径这里的基本路径填写cakephp的目录，当然这里居然没有浏览功能，真是崩溃。</description>
    </item>
    
    <item>
      <title>CakePHP的全局变量</title>
      <link>https://blog.alswl.com/2010/05/cakephp-global-variables/</link>
      <pubDate>Mon, 17 May 2010 00:00:00 +0800</pubDate>
      
      <guid>https://blog.alswl.com/2010/05/cakephp-global-variables/</guid>
      <description>毕业设计AzaAjaxChat 中有一个功能，记录当前在线用户，直观的看，用Application对象就可以解决。
忙了一会发现，原来PHP没有Application对象这个概念，于是我想到了全局变量，噩梦便开始了。（Application 和全局变量其实完全不是同一个概念）
我使用的框架是CakePHP，查找资料后，找到了几种CakePHP中使用全局变量的方法。
一、使用bootstrap.php文件 在app/config 下面，有一个bootstrap文件，从名字就可以看出，这个是在控制器之前加载的文件，根据官方的描述，有下面几个用法。
定义方便的函数 注册全局常量 定义新增的控制器，视图，控制器路径 通过这个文件可以实现全局变量的声明。
if (!isset ($globalAAC)) { global $globalAAC; $globalAAC = array ( &#39;currentMessageId&#39; =&amp;gt; -1, &#39;onlineUsers&#39; =&amp;gt; array() ); } 在其他文件中就可以调用这个全局变量了。
二、通过Configure 类 Configure类是CakePHP用来进行配置文件的地方，通过write() 和read()方法，也能实现全局变量的读写操作。
Configure::write(&#39;Aac.currentMessageId&#39;, -1); Configure::read(&#39;Aac.currentMessageId&#39;); 其中，还有一个使用Configure的偏门方法，我从 [Need to share global variables throughout your app? » Debuggable Ltd](http://debuggable.com/posts/need-to-share-global- variables-throughout-your-app:480f4dd5-6f64-4c88-812d-46d5cbdd56cb) 看到的。
$config =&amp;amp; Configure::getInstance(); $config-&amp;gt;myVariable = &#39;Hello World&#39;; $config =&amp;amp; Configure::getInstance();
debug($config-&amp;gt;myVariable);
其实就是通过引用操作Configure 类内部的getInstance() 方法，看源码就能看出来。
三、关于类似Application 对象的全局变量 以上两种方法都没错，都可以操作全局变量，但是我却都操作失败了，为此我折腾了整整一天。
我甚至一度把错误归结到CakePHP，后来才发现，原来我冤枉它了。问题的根本是在于，这个全局变量根本不是我所想的那个Application 对象。</description>
    </item>
    
    <item>
      <title>使用Firebug和FirePHP调试PHP[译文]</title>
      <link>https://blog.alswl.com/2010/03/use-firebug-and-firephp-debugging-php/</link>
      <pubDate>Mon, 15 Mar 2010 00:00:00 +0800</pubDate>
      
      <guid>https://blog.alswl.com/2010/03/use-firebug-and-firephp-debugging-php/</guid>
      <description>这是我第一篇译文，在写WordPress 主题时候偶尔看到的FirePHP插件，看都这篇文章，不知道为什么，动了翻译的念头。
原文链接：Debug PHP with Firebug and FirePHP
译言的链接：译言网 | 使用Firebug和FirePHP调试PHP
×××××以下译文××××××
如果你和我一样，你会在开发网页项目时候完全无法离开FireBug。这个小巧的&amp;quot;臭虫&amp;quot;是一个神奇而有用的H TML/CSS/JavaScript/Ajax调试器。但是你也许不知道这个还可以用来调试PHP，没错，它可以，感谢一款名为FirePHP的FireFox插件 。
通过一个小小的服务端库，和这款在Firebug上的插件，你的PHP脚本能够发送调试信息到浏览器，轻易的通过HTTP相应头编码。一旦你设置，你可以在Fiire bug的控制台获得PHP脚本警告和错误，就感觉像直接调试JavaScript一样
使用这个工具，首先你需要安装FirePHP插件 。这个插件需要你已经安装FireBug。装好FirePHP之后，重新打开Firebug面板时候，你会看到新加了一个蓝色的臭虫图标。点击这个图标会出现一个开启 或者关闭FirePHP的菜单。
当然，这时候我们还无法做任何事，你还需要安装FirePHP的服务端，点击这里下载。这是一个独立的版本，你可以手动下载或者使用PEAR。装后之后，你可是轻松的将这个库加入你的代码。它被设计了很多版本来整合入多个框架或者管理系统，比如 WP-FirePHP plugin for WordPress 和 JFirePHP plugin for Joomla。暂时不管这些，我们将把精力集中在独立的功能上。
一旦你在你服务器上部署了FirePHP库，你还需要在你的代码中加入以下的代码：
require_once(&#39;FirePHPCore/fb.php&#39;);
这是因为FirePHP通过HTTP头发送记录的数据，你需要缓存你的代码产生的输出，从而来响应头信息从这里获取代码生成的内容。这个可以通过在代码头部的ob_ start来实现。
ob_start();
当这些步骤完成后，你可以开始使用FirePHP了。你需要做的只是调用fb函数在任何你想要记录的地方。同时你也可以使用一个可选的标签和常量去定义预定义信息 ，一个错误，一个警告，或者一条信息。
$var=array(&amp;#39;a&amp;#39;=&amp;gt;&amp;#39;pizza&amp;#39;,&amp;amp;nbsp_place_hold er;&amp;#39;b&amp;#39;=&amp;gt;&amp;#39;cookies&amp;#39;,&amp;#39;c&amp;#39;=&amp;gt;&amp;#39;celery&amp;#39;); fb($var); fb($var,&amp;#34;Anarray&amp;#34;); fb($var,FirePHP::WARN); fb($var,FirePHP::INFO); fb($var,&amp;#39;Anarraywith&amp;amp; nbsp_place_holder;anErrortype&amp;#39;,&amp;amp;nbsp_pla ce_holder;FirePHP::ERROR); $var = array(&amp;#39;a&amp;#39;=&amp;gt;&amp;#39;pizza&amp;#39;, &amp;#39;b&amp;#39;=&amp;gt;&amp;#39;cookies&amp;#39;, &amp;#39;c&amp;#39;=&amp;gt;&amp;#39;celery&amp;#39;);fb($var);fb($var, &amp;#34;An array&amp;#34;);fb($var, FirePHP::WARN);fb($var, FirePHP::INFO);fb($var, &amp;#39;An array with an Error type&amp;#39;, FirePHP::ERROR); 这些代码将在Firebug控制台输出如下所示
你也可以使用FirePHP来跟踪你程序的执行情况：通过使用FirePHP::TRACE常量，你可以在 fb被调用的地方查看``行数、类名和方法名
1 functionhello(){ 2 fb(&amp;#39;HelloWorld!&amp;#39;,&amp;amp;nbs p_place_holder;FirePHP::TRACE); 3 } 4 functiongreet(){ 5 hello(); 6 } 7 greet(); function hello() { fb(&amp;#39;Hello World!</description>
    </item>
    
  </channel>
</rss>
