<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>coding | Log4D</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="author" content="alswl">
<link rel="canonical" href="https://blog.alswl.com/categories/coding/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fcb8ff387cda8551f3867e8c0e2af5aae9b5df9ce2e143e58af5cd709b4e94a3.css" integrity="sha256-/Lj/OHzahVHzhn6MDir1qum135zi4UPlivXNcJtOlKM=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.alswl.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.alswl.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.alswl.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.alswl.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.alswl.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://blog.alswl.com/categories/coding/atom.xml">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-8822123-3', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="coding" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://blog.alswl.com/categories/coding/" /><meta property="og:site_name" content="Log4D" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="coding"/>
<meta name="twitter:description" content=""/>

</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.alswl.com" accesskey="h" title="Log4D (Alt + H)">Log4D</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://en.blog.alswl.com/" title="English Blog">
                    <span>English Blog</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/archives/" title="存档">
                    <span>存档</span>
                </a>
            </li>
            <li>
                <a href="https://blog.alswl.com/about/" title="关于我">
                    <span>关于我</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="https://blog.alswl.com">Home</a>&nbsp;»&nbsp;<a href="https://blog.alswl.com/categories/">Categories</a></div>
  <h1>
    coding
  </h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Python 的类型系统
    </h2>
  </header>
  <div class="entry-content">
    <p>image from pixabay.com
静态类型正在逐渐成为潮流， 2010 年之后诞生的几门语言 Go、Rust、TypeScript 等都走了静态类型路线。 过往流行的一些动态语言（Python、PHP、JavaScript）也在积极引入语言新特性（Type Hint、TypeScript）对静态类型增强。
我曾使用 Python 开发规模较大的项目，感受过动态语言在工程规模变大时候带来的困难： 在重构阶段代码回归成本异常之高，很多历史代码不敢动。 后来技术栈转到 Java，被类型系统怀抱让人产生安全感。
最近一年在一个面向稳定性的运维系统耕耘。系统选型之初使用了 Python。 我在项目中力推了 Python 3.7，并大规模使用了 Python 的类型系统来降低潜在风险。
追根溯源，我花了一些时间了解 Python 在类型系统的设计和实现， 本文以 PEP 提案介绍一下 Python 在类型系统上面走过的路。
类型系统 谈类型系统之前，要厘定两个概念，动态语言和动态类型。
动态语言（Dynamic Programming Language）则是指程序在运行时可以改变结构。 这个结构可以包含函数、对象、变量类型、程序结构。 动态类型是类型系统（Type System）其中一类，即程序在运行期间可以修改变量类型。 另外一种是静态类型：在编译期就决定了变量类型，运行期不允许发生变化。 类型系统还有一种分法是强类型和弱类型，强类型是指禁止类型不匹配的指令，弱类型反之。
动态语言和动态类型这两个概念切入点不一样， Python 是一门动态语言，也是动态类型语言，还是强类型的动态类型。 这篇文章主要讨论 Python 语言的类型系统，不会涉及动态语言特性。
类型安全之路 行业里面一直有一个争论：动态类型和静态类型哪一种更强大。 静态类型的支持者认为三个方面具备优势：性能、错误发现、高效重构。 静态类型通过编译期决定具体类型可以显著的提高运行期效率； 编译期就能够发现错误，在工程规模逐步变大时候尤其明显； 类型系统可以帮助 IDE 提示，高效重构。 动态类型的支持者则认为分析代码会更简单，减少出错机会，写起来也更为快速。
Python 开发者们并非没有看到这个痛点， 一系列 PEP 提案应运而生。 在保留 Python 动态类型系统优势前提，通过语法、特性增强，将类型系统引入 Python。
Python 在 2014 年即提出了 PEP 484，随后提出一个精粹版 PEP 483（The Theory of Type Hints）， 其工程实现 typing 模块在 3....</p>
  </div>
  <footer class="entry-footer"><span title='2020-06-23 17:54:00 +0800 +0800'>2020-06-23</span>&nbsp;·&nbsp;alswl</footer>
  <a class="entry-link" aria-label="post link to Python 的类型系统" href="https://blog.alswl.com/2020/06/type-safe-python/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>浅谈 Code Review 之事前准备
    </h2>
  </header>
  <div class="entry-content">
    <p>随着业务规模扩大、团队组成变复杂，如何降低项目实施风险，降低软件复杂度变得尤为关键。 我从 Martin Flower、Joel Spolsky（软件随想录 作者） 等巨匠智慧中寻找解决复杂工程之道，其中 Code Review 是行之有效手段。 我认同 Code Review 价值也是忠实执行者。
加入蚂蚁以后，我在所接触项目中都大力推广 Code Review。 感谢团队信任和支持，目前 CR 协作进展顺利， 项目 CR 从最早不主动，到现在形成基于模块 Owner 制度 CR 和 Peer Review。 我也曾经在 3 个月内处理完成 700 多个 Pull Request，并在 PR 讨论中中都留下一些有价值讨论。 这里我将自己对 Code Review 一些理解记录下来。
这一篇先讲讲进入 Code Review 之前需要做准备工作。
评估团队成熟度 不管是在一个遗留系统上推广 Code Review，还是在一个新团队推广 Code Review， 起手式不是立马挽起袖子猛干，而是应当观察一下当前所处情况是否允许自己推动这个「艰巨」任务。 最需要观察的是团队成熟度。
我将团队成熟度粗略分为草台班子、成长型团队、成熟团队。 具体衡量指标可以有成员技术储备、团队成员信任度、团队负责人对工程管控力度。 相信集团内大部分团队处于成长型、成熟型团队。 但如果考虑到生态同学一起协作，或者临时因为紧急项目凑在一起，就比较容易成为「草台班子」。
如果还停留在草台班子，那就得先在团队内形成一定共识： 包括技术共识和合作模式的共识。 技术共识需要包括：技术栈共识、好代码定义、研发流程共识等。 合作模式共识需要包括：冲突解决机制、职责范围边界、决策机制等。 如果基本共识还没有形成就仓促进入 Code Review，那就容易将一件好事变成工程师战争。
并不是所有团队、项目都适合无差别引入 Code Review。这么几种情况建议暂缓 Code Review 推广：...</p>
  </div>
  <footer class="entry-footer"><span title='2020-03-31 12:13:00 +0800 +0800'>2020-03-31</span>&nbsp;·&nbsp;alswl</footer>
  <a class="entry-link" aria-label="post link to 浅谈 Code Review 之事前准备" href="https://blog.alswl.com/2020/03/before-code-review/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>从 SQL Server 到 MySQL（三）：愚公移山 - 开源力量
    </h2>
  </header>
  <div class="entry-content">
    <p>该系列三篇文章已经全部完成：
从 SQL Server 到 MySQL（一）：异构数据库迁移 - Log4D 从 SQL Server 到 MySQL（二）：在线迁移，空中换发动机 - Log4D 从 SQL Server 到 MySQL（三）：愚公移山 - 开源力量 - Log4D 我们用了两章文章 从 SQL Server 到 MySQL（一）：异构数据库迁移 / 从 SQL Server 到 MySQL（二）：在线迁移，空中换发动机 介绍我们遇到问题和解决方案。 不管是离线全量迁移还是在线无缝迁移， 核心 ETL 工具就是 yugong。
Yugong 是一个成熟工具， 在阿里巴巴去 IOE 行动中起了重要作用， 它与 Otter / Canal 都是阿里中间件团队出品。 它们三者各有分工： Yugong 设计目标是异构数据库迁移； Canal 设计用来解决 MySQL binlog 订阅和消费问题； Otter 则是在 Canal 之上，以准实时标准解决数据库同步问题。 Otter 配备了相对 yugong 更健壮管理工具、分布式协调工具， 从而长期稳定运行。Yugong 设计目标则是一次性迁移工作，偏 Job 类型。 当然 yugong 本身质量不错，长期运行也没问题。 我们有个产线小伙伴使用我们魔改后 yugong， 用来将数据从管理平台同步数据到用户前台，已经稳定跑了半年多了。...</p>
  </div>
  <footer class="entry-footer"><span title='2018-06-20 20:18:52 +0800 +0800'>2018-06-20</span>&nbsp;·&nbsp;alswl</footer>
  <a class="entry-link" aria-label="post link to 从 SQL Server 到 MySQL（三）：愚公移山 - 开源力量" href="https://blog.alswl.com/2018/06/sql-server-migration-3/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>从 SQL Server 到 MySQL（二）：在线迁移，空中换发动机
    </h2>
  </header>
  <div class="entry-content">
    <p>该系列三篇文章已经全部完成：
从 SQL Server 到 MySQL（一）：异构数据库迁移 - Log4D 从 SQL Server 到 MySQL（二）：在线迁移，空中换发动机 - Log4D 从 SQL Server 到 MySQL（三）：愚公移山 - 开源力量 - Log4D （image via https://pixabay.com/en/military-stealth-bomber-refueling-602729/ ）
在上篇文章 从 SQL Server 到 MySQL （一）：异构数据库迁移 - Log4D 中，我们给大家介绍了从 SQL Server 到 MySQL 异构数据库迁移的基本问题和全量解决方案。 全量方案可以满足一部分场景的需求，但是这个方案仍然是有缺陷的： 迁移过程中需要停机，停机的时长和数据量相关。 对于核心业务来说，停机就意味着损失。 比如用户中心的服务，以它的数据量来使用全量方案，会导致迁移过程中停机若干个小时。 而一旦用户中心停止服务，几乎所有依赖于这个中央服务的系统都会停摆。
能不能做到无缝的在线迁移呢？系统不需要或者只需要极短暂的停机？ 作为有追求的技术人，我们一定要想办法解决上面的问题。
在线迁移的原理和流程 针对 Oracle 到 MySQL，市面上已经有比较成熟的解决方案 - alibaba 的 yugong 项目。 在解决 SQL Server 到 MySQL 在线迁移之前，我们先研究一下 yugong 是如何做到 Oracle 的在线迁移。...</p>
  </div>
  <footer class="entry-footer"><span title='2018-05-21 11:24:36 +0800 +0800'>2018-05-21</span>&nbsp;·&nbsp;alswl</footer>
  <a class="entry-link" aria-label="post link to 从 SQL Server 到 MySQL（二）：在线迁移，空中换发动机" href="https://blog.alswl.com/2018/05/sql-server-migration-2/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>从 SQL Server 到 MySQL（一）：异构数据库迁移
    </h2>
  </header>
  <div class="entry-content">
    <p>该系列三篇文章已经全部完成：
从 SQL Server 到 MySQL（一）：异构数据库迁移 - Log4D 从 SQL Server 到 MySQL（二）：在线迁移，空中换发动机 - Log4D 从 SQL Server 到 MySQL（三）：愚公移山 - 开源力量 - Log4D 背景 沪江成立于 2001 年，作为较早期的教育学习网站， 当时技术选型范围并不大： Java 的版本是 1.2，C# 尚未诞生，MySQL 还没有被 Sun 收购， 版本号是 3.23。 工程师们选择了当时最合适的微软体系，并在日后的岁月里， 逐步从 ASP 过度到 .net，数据库也跟随 SQL Server 进行版本升级。
十几年过去了，技术社区已经发生了天翻地覆的变化。 沪江的技术栈还基本在 .net 体系上，这给业务持续发展带来了一些限制。 人才招聘、社区生态、架构优化、成本风险方面都面临挑战。 集团经过慎重考虑，发起了大规模的去 Windows 化项目。 这其中包含两个重点子项目：开发语言从 C# 迁移到 Java， 数据库从 SQL Server 迁移到 MySQL。
本系列文章就是向大家介绍， 从 SQL Server 迁移到 MySQL 所面临的问题和我们的解决方案。...</p>
  </div>
  <footer class="entry-footer"><span title='2018-03-12 21:08:56 +0800 +0800'>2018-03-12</span>&nbsp;·&nbsp;alswl</footer>
  <a class="entry-link" aria-label="post link to 从 SQL Server 到 MySQL（一）：异构数据库迁移" href="https://blog.alswl.com/2018/03/sql-server-migration-1/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>服务性能监控：USE 方法（The USE Method）
    </h2>
  </header>
  <div class="entry-content">
    <p>本文首发在沪江技术学院公众号，小莞翻译，我做了校对。 由于微信公众号的封闭性，我担心未来文章不容易被发现。 为了避免沧海遗珠，特意转到这里。
英文原文：The USE Method。
USE 方法是一种能分析任何系统性能的方法论。 我们可以根据能帮助系统分析的结构化清单，来迅速的定位资源的瓶颈和错误所在。 它通常会先以列出问题为开始，然后再寻找适合的指标，而不是给你制定一些固定的指标， 然后让你按部就班的执行下去。
本页左侧下方，是我列出的，根据不同的操作系统（Linux、 Solaris 等） 衍生的 USE 方法列表。（译者注：可以参考原文链接）
我列出了为不同的操作系统而衍生的 USE 方法列表供大家参考， 你们可以根据你的环境来为你的站点服务，选择适合的附加监控指标。
通过这个工具，可以很方便的筛选出适合不同的系统的建议 metrics：USE Method: Rosetta Stone of Performance Checklists
Intro（Introduction） 如果你遇到一个很严重的性能问题升级的时候，并且你不能确定它是否由服务导致的， 这时候你该怎么办？
我们都说万事开头难。所以我开发出了 USE 方法，来帮助大家，如何去快速的解决常见的性能问题，而同时又不容易忽略重要的地方。
USE 方法在设计之初就定位了简洁、明了、完整、快速的特性， 就好像一本航天手册的紧急事项列表那样。 （译者注：航天手册，介绍包括不限于飞机的各种特性、指标、性能等， 用于帮助飞行学员学习驾驶飞机，或者是帮助那些希望提高他们的飞行潜能和航空知识的人了解的更全面）。
USE 方法已经在不同的企业、课堂（作为学习工具）以及最近的云计算等场景中，被成功应用了无数次。
USE 方法基于 3&#43;1 模型（三种指标类型&#43;一种策略），来切入一个复杂的系统。我发现它仅仅发挥了 5% 的力量，就解决了大概 80% 的服务器问题，并且正如我将证明的，它除了服务器以外，也同样适应于各种系统。
它应当被理解为一种工具，一种很大的方法工具箱里面的工具。不过，它目前仍然还有很多问题类型以待解决，还需要点其他方法和更多的时间。
Summary USE 方法可以概括为：检查所有的资源的利用率，饱和度，和错误信息。
我们期望大家能尽早使用 USE 方法去做性能检查，或者是用它确定系统的瓶颈。
名词定义：
资源： 服务器功能性的物理组成硬件（CPU， 硬盘, 总线） 利用率： 资源执行某工作的平均时间 饱和：衡量资源超载工作的程度，往往会被塞入队列 错误： 错误事件的数量 分析软件资源，或者是软件的强制性限制（资源控制）也是很有用的，同时要关注哪些指标是处于正常的可接受范围之内的。这些指标通常用以下术语表示：
利用率： 以一个时间段内的百分比来表示，例如：一个硬盘以 90% 的利用率运行 饱和度： 一个队列的长度，例如：CPUs 平均的运行时队列长度是4 错误（数）： 可度量的数量，例如：这个网络接口有 50 次（超时？） 我们应该要调查那些错误，因为它们会降低系统的性能，并且当故障模型处于可回复模式的时候，它可能不会立刻被发现。...</p>
  </div>
  <footer class="entry-footer"><span title='2017-11-12 15:30:12 +0800 +0800'>2017-11-12</span>&nbsp;·&nbsp;小莞</footer>
  <a class="entry-link" aria-label="post link to 服务性能监控：USE 方法（The USE Method）" href="https://blog.alswl.com/2017/11/use-method/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Stack Overflow 的 HTTPS 化：漫漫长路的终点
    </h2>
  </header>
  <div class="entry-content">
    <p>原文作者：Nick Craver 翻译作者：罗晟 @luosheng &amp; @alswl 原文地址：Nick Craver - HTTPS on Stack Overflow: The End of a Long Road 本文为原创翻译文章，已经获得原作者授权，转载请注明作者及出处。 本文首发在「沪江技术学院」公众号 今天，我们默认在 Stack Overflow 上部署了 HTTPS。目前所有的流量都将跳转到 https:// 上。与此同时，Google 链接也会在接下去的几周内更改。启用的过程本身只是举手之劳，但在此之前我们却花了好几年的时间。到目前为止，HTTPS 在我们所有的 Q&amp;A 网站上都默认启用了。
在过去的两个月里，我们在 Stack Exchange 全网维持发布 HTTPS。Stack Overflow 是最后，也是迄今最大的的一个站点。这对我们来说是一个巨大里程碑，但决不意味着是终点。后文会提到，我们仍有很多需要做的事情。但现在我们总算能看得见终点了，耶！
友情提示：这篇文章讲述的是一个漫长的旅程。非常漫长。你可能已经注意到你的滚动条现在非常小。我们遇到的问题并不是只在 Stack Exchange/Overflow 才有，但这些问题的组合还挺罕见。我在文章中会讲到我们的一些尝试、折腾、错误、成功，也会包括一些开源项目——希望这些细节对你们有所帮助。由于它们的关系错综复杂，我难以用时间顺序来组织这篇文章，所以我会将文章拆解成架构、应用层、错误等几个主题。
首先，我们要提一下为什么我们的处境相对独特：
我们有几百个域名（大量站点及服务） 大量二级域名（stackoverflow.com、stackexchange.com、askubuntu.com等） 大量四级域名（如 meta.gaming.stackexchange.com） 我们允许用户提交、嵌入内容（比如帖子中的图片和 YouTube 视频） 我们仅有一个数据中心（造成单源的延时） 我们有广告（及广告网络） 我们用 websockets，任何时刻的活跃数都不少于 50 万个（连接数问题） 我们会被 DDoSed 攻击（代理问题） 我们有不少站点及应用还是通过 HTTP API 通信的（代理问题） 我们热衷于性能（好像有点太过了） 由于这篇文章实在太长，我在这里先列出链接：
开篇 懒人包 基础设施 证书 Meta 子域（meta....</p>
  </div>
  <footer class="entry-footer"><span title='2017-09-27 12:07:44 +0800 +0800'>2017-09-27</span>&nbsp;·&nbsp;罗晟, alswl</footer>
  <a class="entry-link" aria-label="post link to Stack Overflow 的 HTTPS 化：漫漫长路的终点" href="https://blog.alswl.com/2017/09/https-on-stack-overflow/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>一个关于 nolock 的故事：深入理解数据库隔离级别
    </h2>
  </header>
  <div class="entry-content">
    <p>加入沪江不久，我就被扔到一个将集团 SQL Sever 的数据库迁移到 MySQL 的项目里， 同时伴随进行的还有 .net 系统迁移到 Java 系统。 在这个过程中我发现了一个很有趣的现象：历史遗留的 .net 项目中， 几乎所有的 SQL 中都会使用一个关键字：nolock。 这让我很困惑，nolock 的字面意思是对当前技术不使用锁技术，为什么要这样用呢？
我找了一个范例如下：
SELECT [id] FROM [dbo].[foos] WITH(nolock) WHERE aField = 42 AND bField = 1 作为横向支持工程师，开发工程师会问我：「数据库即将从 SQL Server 迁移到 MySQL，我们编码中还需要使用 nolock 么？ MySQL 里面对应的写法是什么？」。 我并没有 SQL Server 的生产环境使用经验，一时间无法回答。 于是课后做相关知识学习，这里就是这次学习的一点成果。
这个问题将被拆解成三个小问题进行回答：
nolock 是什么？ 为什么会需要在每个 Query 语句使用 nolock？ MySQL 的对应写法是什么？ 让我们一个一个来看。
第一个问题：nolock 是什么？ nolock 是 SQL Server 的一个关键字，这类关键字官方将其称之为 Hints。 Hints 的设计目的是为了能够让 SQL 语句在运行时，动态修改查询优化器的行为。 在语法上，Hints 以 WITH 开头。除了 WITH(nolock)， 还有 TABLOCK / INDEX / ROWLOCK 等常见的 Hints。...</p>
  </div>
  <footer class="entry-footer"><span title='2017-09-19 16:43:45 +0800 +0800'>2017-09-19</span>&nbsp;·&nbsp;alswl</footer>
  <a class="entry-link" aria-label="post link to 一个关于 nolock 的故事：深入理解数据库隔离级别" href="https://blog.alswl.com/2017/09/sql-server-nolock/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>当我们在聊监控，我们在聊什么？
    </h2>
  </header>
  <div class="entry-content">
    <p>最近在团队中给大家做了一个分享，泛泛地聊了一些有关「监控」的话题。 其实做分享对分享者的作用往往大于参与者。 这是一次将自己知识的梳理的过程，于是我将这次分享整理成这篇文章。
目的 🎯 我们先来聊聊，什么是「监控」，以及我们期望通过「监控」完成哪些目的？
传统意义上的监控，是指：
通过一些手段和工具，关注运行中的硬件、软件、用户体验的关键数据，将其暴露出来。 当关键数据出现异常时候发出警告，进行人工或者自动的响应。
我们平时看到的最常见的监控系统，比如 Zabbix，提供了丰富的模板， 可以监控服务器的 Load / CPU Usage / Alive 这些常规指标。 并在出现问题时候，对其进行报警通知。 随后运维工程师们会上线进行应急操作，case by case 的处理故障。
我将上面的使用目的归纳为：
故障发生时提供数据报警 提供历史数据以供分析 故事到这里似乎可以结束了，可监控真的是这么简单的么？ 当然没，随着时代的进步，用户对服务提出了更为严苛的要求， 同时我们也有能力进一步控制平均故障修复时间 （MTBF）， 上述描述的做法已经不能满足我们了。
现在让我们切换一下视角，从传统的 OPS 的视角切换到 SRE （Site Reliability Engineering）的视角。 当我们在关注网站整体的可用性时，我们会发现： 故障警报处理当然很重要，但是我们根本上想减少甚至避免 MTBF。 我们有两种手段： 一种是去除单点故障，让问题自然发生，但是不对线上造成影响； 另一种是在问题出现的早期就发现并进行及时修复。 前者是高可用范畴，后者就是我们今天关注的「监控」了。
监控的目的是要将灾难消灭在襁褓里；在灾难即将出现或者发生问题时， 给大家展示直接的原因。
那为了达成这两个目标，我们需要回到问题的本质，重新思考两个问题：
监控哪些对象？ 如何识别故障？ 对象 🐘🐘 我们说的监控对象，一般指的都是某个资源， 资源即持有某种其他方需要的某些属性的载体，包括硬件、软件。 除了资源这种类型，还有一种常见的监控对象是「体验」，即终端用户的访问感受， 这块内容我们暂时略去。
让我们来先看一下常见的资源：
硬件 服务器 网络设备 软件 Application Infrastructure 这个分类是粗粒度的描述，为了落地地描述监控对象对象的健康状况， 我们还要进一步细化。以「服务器」为例，我们可以将其监控的内容细化为以下监控项：
CPU Memory Network interface Storage devices Controllers 如何评估这些监控项的健康状况？我们使用 SLI（Service Level Indicator）。 比如可用性就是一个最容易理解的 SLI。 这里我将资源归为两类，面向用户提供服务的资源和面向存储的资源， 以下是针对这两类资源的常见 SLI：...</p>
  </div>
  <footer class="entry-footer"><span title='2017-06-08 15:40:41 +0800 +0800'>2017-06-08</span>&nbsp;·&nbsp;alswl</footer>
  <a class="entry-link" aria-label="post link to 当我们在聊监控，我们在聊什么？" href="https://blog.alswl.com/2017/06/monitoring-introducing/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>XSS 攻击的处理
    </h2>
  </header>
  <div class="entry-content">
    <p>这是一年前写的项目笔记，一直在我的待办事项里等待做总结，今天偶然翻到，就整理成文章发出来。 谨以此文怀念 乌云。
事情缘由 春节前的某一天，收到一封来自乌云（国内知名白帽子团队）的邮件， 告知我厂网站上出现一例 XSS 漏洞。 因为以前对 XSS 输入做过防御，还以为是某个前端 DOM 上的 XSS 漏洞， 后来仔细一看，不妙，是个影响甚大的存储型 XSS 漏洞。
这里简单科普一下 XSS 跨网站脚本 -维基百科，自由的百科全书 中介绍到：
跨网站脚本（Cross-site scripting，通常简称为XSS或跨站脚本或跨站脚本攻击）是一种网站应用程序的安全漏洞攻击，是代码注入的一种。 它允许恶意用户将代码注入到网页上，其他用户在观看网页时就会受到影响。这类攻击通常包含了HTML以及用户端脚本语言。
XSS 攻击可以分成两种，反射性 XSS / 存储型 XSS。前者是需要用户触发的 XSS， 针对当前用户的攻击行为。而后者存储型 XSS 则更为严重，一旦攻击代码被保存， 所有访问被攻击的页面，都会触发用户被攻击行为。
这次爆出的问题就是最严重的存储型 XSS，意味着每个访问到有问题页面的用户都会中招。 时间紧迫，问题必须被解决。
XSS 实现手段 在解决问题之前，需要对这个问题有必要的基础认识。 我们先看看 XSS 攻击是如何工作的，以及攻击者的目的是什么。
XSS 的原理是通过构造特殊的数据，并通过传递参数或者保存表单数据的方式， 让这些构建的数据破坏 DOM 结构，从而让自己预先构造数据中的 JS 脚本被执行。
检查存储型 XSS 漏洞的方法，可以在对应的 input field 里放入一些构造的数据，如果保存后可以被执行，就说明存在 XSS 漏洞。
常见的检测方法（来自 跨网站脚本 - 维基百科，自由的百科全书：
&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt; =&#39;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt; &#34;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt; &lt;script&gt;alert(document.cookie)&lt;/script&gt; &lt;script&gt;alert (vulnerable)&lt;/script&gt; %3Cscript%3Ealert(&#39;XSS&#39;)%3C/script%3E &lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt; &lt;img src=&#34;javascript:alert(&#39;XSS&#39;)&#34;&gt; &lt;img src=&#34;http://xxx....</p>
  </div>
  <footer class="entry-footer"><span title='2017-05-31 22:04:00 +0800 +0800'>2017-05-31</span>&nbsp;·&nbsp;alswl</footer>
  <a class="entry-link" aria-label="post link to XSS 攻击的处理" href="https://blog.alswl.com/2017/05/xss/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="next" href="https://blog.alswl.com/categories/coding/page/2/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://blog.alswl.com">Log4D</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
